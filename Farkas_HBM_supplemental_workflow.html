<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.30">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Model supplement: Robust single-trial estimates of electrocortical generalized aversive conditioning: Validation of a Bayesian multilevel learning model</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="Farkas_HBM_supplemental_workflow_files/libs/clipboard/clipboard.min.js"></script>
<script src="Farkas_HBM_supplemental_workflow_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="Farkas_HBM_supplemental_workflow_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="Farkas_HBM_supplemental_workflow_files/libs/quarto-html/popper.min.js"></script>
<script src="Farkas_HBM_supplemental_workflow_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Farkas_HBM_supplemental_workflow_files/libs/quarto-html/anchor.min.js"></script>
<link href="Farkas_HBM_supplemental_workflow_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Farkas_HBM_supplemental_workflow_files/libs/quarto-html/quarto-syntax-highlighting-de070a7b0ab54f8780927367ac907214.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Farkas_HBM_supplemental_workflow_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Farkas_HBM_supplemental_workflow_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Farkas_HBM_supplemental_workflow_files/libs/bootstrap/bootstrap-b2764c3be108046f48bfaabb1ce3af2a.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="fullcontent quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Model supplement: Robust single-trial estimates of electrocortical generalized aversive conditioning: Validation of a Bayesian multilevel learning model</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="rationale-of-document" class="level1">
<h1>Rationale of Document</h1>
<p>This document aims to detail all models fit for the associated technical report (DOI: ) and the rationale for the priors. According to best practices from the Gelman and McElreath textbooks, priors should be selected to represent the multilevel nature of the data or be uninformative where applicable. Multilevel priors distinguish where an estimate is likely to be coming from a higher-level group such as the mean of a participant from a normal distribution of all participants. Uninformative priors should gently guide parameters within a realistic scale for the data based on domain expertise, but be wide enough such that the results are nearly entirely based on the observed data. To ensure this is done correctly, it is standard practice that prior predictive distributions are visualized to confirm they are on believable scales for the data at hand.</p>
</section>
<section id="fmri-models" class="level1">
<h1>fMRI Models</h1>
<p>After the second revision, it was suggested that we demonstrate the approach in a different modality. For this reason we include some preliminary models fit to the fMRI data from the same study.</p>
<p>The purpose of this analysis was to demonstrate that a multilevel structure just inherently improves model fitting and cross validation accuracy. As can be seen in the paper (Figure 1), the well-established phenomenon detailed in (Gelman et al., 2012). The reason this works is because we are modeling something that is inherently true, that there is a multilevel structure to our data and that seeing the data from one participant will inform can inform an estimate for someone else. The Richard McElreath lecture is one of the best examples where the multilevel prior will result in the best cross-validation accuracy as if it were tuned by an algorithm by hand (https://youtu.be/iwVqiiXYeC4?si=e2dlkfzm6ccHTOuq&amp;t=1182).</p>
<p>So in the paper we demonstrate this on the well-established restricted maximum likelihood regression used in AFNI. It can be thought of as a standard multiple regression written in matrix notation. However, there is one added element of complexity that tries to account for how fMRI noise will be temporally correlated. This is common for timeseries data, if the last measurement was high because of noise then the next measurement is more likely to also be above average.</p>
<p>We’ll start with the likelihood function that connects the data to our statistical model. So where <span class="math inline">\(p\)</span> is the index for participant the likelihood function is:</p>
<p><span class="math display">\[
\begin{gather}
\overrightarrow{BOLD[p, \ 1:NCensoredVolumes[p]]} \sim MVNormal \left(
\overrightarrow{\mu[p]} , \
\begin{array}{c}
{\huge \Sigma}
\end{array}[p]
\right)\\
\\
\overrightarrow{\mu[p]} = \mathbf{CensoredDesignMatrix}[p] \cdot \overrightarrow{Betas[p]} \\
\end{gather}
\]</span></p>
<p>So, we can see that our prediction if noise didn’t exist (<span class="math inline">\(\overrightarrow{\mu}\)</span>) is a vector/1-d array and that we only make predictions for data that were not censored because of movement. This is a common model used for the first-level of a fMRI analysis where you fit the regression per participant per voxel or region of interest. Now let’s look at what <span class="math inline">\(\Sigma\)</span> is and how temporal correlated noise is modeled:</p>
<p><span class="math display">\[
\begin{gather}
{\huge \Sigma}[p] = {\huge \Sigma}Uncensored[UseableVolumeIndices[p]][p] \\
\\
\begin{array}{c}
{\huge \Sigma}Uncensored[p]
\end{array} =
\mathrm{\sigma}_{}^{2}[p] \cdot
\begin{bmatrix}
1 &amp; \delta \rho &amp; \delta \rho ^2 &amp; \delta \rho ^3 &amp; ... &amp; \delta \rho ^k \\
\delta \rho &amp; 1 &amp; \delta \rho &amp; \delta \rho ^2 \\
\delta \rho ^2 &amp; \delta \rho &amp; 1 &amp; \delta \rho\\
\delta \rho ^3 &amp; \delta \rho ^2 &amp; \delta \rho &amp;  1 \\
...\\
\delta \rho ^j\\
\end{bmatrix}[p]\\
\\
\sigma[1:nPar] \ge 0; \ \delta[1:nPar] \in [0,1]; \ \rho[1:NPar] \in [0,1]\\
\end{gather}
\]</span></p>
<p>This model was pulled straight from the AFNI help documents for 3dREMLfit (https://afni.nimh.nih.gov/pub/dist/doc/misc/3dREMLfit/3dREMLfit_mathnotes.pdf). This is known as a type of Toeplitz matrix. What this models is how noise correlations should drop off with distance from the current volume. The <span class="math inline">\(\sigma ^2\)</span> is the variance which is going to turn the correlation matrix into the covariance matrix we ultimately want. Here <span class="math inline">\(\delta\)</span> is the ratio noise that can be attributed to auto-correlation, it scales down <span class="math inline">\(\rho\)</span> with both of them collectively being the expected correlation. We can see the exponent gets larger for volumes that are farther away from the current volume. This will ultimately drop the correlation to zero with distance.</p>
<p>Because this is a Bayesian model, we must now specify the priors. To enhance computational efficiency, we used noncentered and scaled parameterization. This just means that we let Stan sample the easiest topography possible. The easiest one is if we can make every parameter not correlated and a standard normal (Normal(0,1); Z-distribution), and then transform them after the fact. This helps Stan, because it is a variant of Hamiltonian Monte Carlo that essentially simulates a ball rolling in a bowl, where the height of the bowl is the posterior at that position.</p>
<p>For example, the following is the noncentered parameterization for <span class="math inline">\(\sigma\)</span> the nonmultilevel model:</p>
<p><span class="math display">\[
\begin{gather}
\sigma[p] = 0.5 \cdot \sigma Z [p]\\
\sigma Z [p] \sim HalfNormal(0, 1) \\
\end{gather}
\]</span></p>
<p>Which is equivalent to the following, but will be estimated quicker with less steps before each sample is taken:</p>
<p><span class="math display">\[
\begin{gather}
\sigma[p] \sim HalfNormal(0, 0.5)
\end{gather}
\]</span></p>
<p>The rest of the priors for non multilevel model are:</p>
<p><span class="math display">\[
\begin{gather}
\delta [p] = invLogit(1.75 \cdot delta Z [p])\\
\rho [p] = invLogit(1.75 \cdot rho Z [p]) \\
\\
\delta Z [p] \sim Normal(0,1)\\
\rho Z [p] \sim Normal(0,1)\\
Betas [p, \ b] \sim Normal(0,1)\\
\end{gather}
\]</span></p>
<p>These are obviously uninformative priors for the scale of our data. This model reach near identical point estimates and uncertainty as the AFNI Frequentist statistical model.</p>
<p>For the multilevel model, we only change the priors such that the group’s distribution is the multilevel prior for each individual parameter. The noncentered parameterization here is trickier to understand. It works by estimating the Z-score of each parameter and using that to recover the actual parameter deterministically that we want to pull from the multilevel distribution. For example:</p>
<p><span class="math display">\[
\begin{gather}
\sigma[p] = \mu \sigma \cdot 0.5 \cdot \tau \sigma \cdot \sigma Z [p]\\
\sigma Z [p] \sim Normal(0, 1) \\
\mu \sigma [p] \sim HalfNormal(0, 1) \\
\tau \sigma [p] \sim Normal(0, 1) \\
\end{gather}
\]</span></p>
<p>Is equivalent to the following:</p>
<p><span class="math display">\[
\begin{gather}
\sigma[p] \sim Normal ( \mu \sigma, \tau \sigma) \\
\mu \sigma \sim Half Normal(0, 0.5)\\  
\tau \sigma \sim Half Normal(0, 1)\\  
\end{gather}
\]</span></p>
<p>The EEG models don’t use the noncentered parameterization so those examples may be helpful for understanding multilevel priors more thoroughly.</p>
<p>The last thing to note is why this model required the use of cluster super computer. It is because to find the likelihood of a multivariate normal distribution, you must invert the matrix in one form or another which is computationally expensive. In the model, the matrix is put through a Cholesky decomposition which transforms it to a “whitened” version that temporarily takes out the correlation (also done in AFNI for this model). The required matrix inversion is the most computationally expensive part where computational time scales with the cube of the matrix dimension: <span class="math inline">\(O(n^3)\)</span>. Then take into account that each participant gets their own covariance matrix. Lastly, because we need to simulate the physics of traversing the model’s posterior landscape, that means we have to solve for the posterior many times per sample. For the Frequentist model, you just need to solve it down to the most likely point and then you are done.</p>
<p>The insight is that we can find the likelihoods of each participant out of order split across many computers / CPUS. So the models in the supplemental materials use the Stan map_rect function to split up the likelihood calculation. Then when the model is sampled, a SLURM script uses the Message Passing Interface (MPI) to assign each participant’s likelihood calculation to a different CPU core. So for each chain, 24 CPU cores are assigned for the 24 participants. Each chain took about a day and a half” to finish.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.4     ✔ readr     2.1.5
✔ forcats   1.0.0     ✔ stringr   1.5.1
✔ ggplot2   3.5.2     ✔ tibble    3.2.1
✔ lubridate 1.9.4     ✔ tidyr     1.3.1
✔ purrr     1.0.4     
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggridges)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggbeeswarm)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># load necessary data and models</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="co"># load(file = "/home/andrewf/Research_data/EEG/Gaborgen24_EEG_fMRI/misc/supplemental_data.RData")</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="at">file =</span> <span class="st">"/home/andrewfarkas/tmp/restore3/home/andrewf/Research_data/EEG/Gaborgen24_EEG_fMRI/misc/supplemental_data.RData"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="visualization-of-ratings-for-reviewers" class="level1">
<h1>Visualization of ratings for reviewers</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>rating_text_size <span class="ot">&lt;-</span><span class="dv">15</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>Oz_fft_df <span class="sc">%&gt;%</span> </span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(participant, block, cue) <span class="sc">%&gt;%</span> </span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reframe</span>(<span class="at">avg_ar =</span> <span class="fu">mean</span>(ar)) <span class="sc">%&gt;%</span> </span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">"block_named"</span> <span class="ot">=</span> <span class="fu">case_when</span>(</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    block <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">"Habituation"</span>,</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    block <span class="sc">==</span> <span class="dv">2</span> <span class="sc">~</span> <span class="st">"Acquisition #1"</span>,</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>    block <span class="sc">==</span> <span class="dv">3</span> <span class="sc">~</span> <span class="st">"Acquisition #2"</span>,</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>    block <span class="sc">==</span> <span class="dv">4</span> <span class="sc">~</span> <span class="st">"Extinction"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">block_named =</span> <span class="fu">factor</span>(block_named, </span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">levels =</span> <span class="fu">c</span>(</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Habituation"</span>,</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Acquisition #1"</span>,</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Acquisition #2"</span>,</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Extinction"</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>  ))) <span class="sc">%&gt;%</span> </span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_quasirandom</span>(<span class="fu">aes</span>(<span class="at">x =</span> cue, <span class="at">y =</span> avg_ar, <span class="at">color =</span> cue)) <span class="sc">+</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>    <span class="sc">~</span>block_named, <span class="at">nrow =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> cue_color) <span class="sc">+</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">name =</span> <span class="st">"Arousal Rating"</span>) <span class="sc">+</span></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Participant Arousal Ratings per Cue by Block"</span>) <span class="sc">+</span></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> rating_text_size))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Farkas_HBM_supplemental_workflow_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>Oz_fft_df <span class="sc">%&gt;%</span> </span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(participant, block, cue) <span class="sc">%&gt;%</span> </span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reframe</span>(<span class="at">avg_val =</span> <span class="fu">mean</span>(val)) <span class="sc">%&gt;%</span> </span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">"block_named"</span> <span class="ot">=</span> <span class="fu">case_when</span>(</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    block <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">"Habituation"</span>,</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    block <span class="sc">==</span> <span class="dv">2</span> <span class="sc">~</span> <span class="st">"Acquisition #1"</span>,</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    block <span class="sc">==</span> <span class="dv">3</span> <span class="sc">~</span> <span class="st">"Acquisition #2"</span>,</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    block <span class="sc">==</span> <span class="dv">4</span> <span class="sc">~</span> <span class="st">"Extinction"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">block_named =</span> <span class="fu">factor</span>(block_named, </span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">levels =</span> <span class="fu">c</span>(</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Habituation"</span>,</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Acquisition #1"</span>,</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Acquisition #2"</span>,</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Extinction"</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>  ))) <span class="sc">%&gt;%</span> </span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_quasirandom</span>(<span class="fu">aes</span>(<span class="at">x =</span> cue, <span class="at">y =</span> avg_val, <span class="at">color =</span> cue)) <span class="sc">+</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>    <span class="sc">~</span>block_named, <span class="at">nrow =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> cue_color) <span class="sc">+</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">name =</span> <span class="st">"Valence Rating"</span>) <span class="sc">+</span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Participant Valence Ratings per Cue by Block"</span>) <span class="sc">+</span></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> rating_text_size))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Farkas_HBM_supplemental_workflow_files/figure-html/unnamed-chunk-2-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>Oz_fft_df <span class="sc">%&gt;%</span> </span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(participant, block, cue) <span class="sc">%&gt;%</span> </span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reframe</span>(<span class="at">avg_exp =</span> <span class="fu">mean</span>(exp)) <span class="sc">%&gt;%</span> </span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">"block_named"</span> <span class="ot">=</span> <span class="fu">case_when</span>(</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    block <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">"Habituation"</span>,</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    block <span class="sc">==</span> <span class="dv">2</span> <span class="sc">~</span> <span class="st">"Acquisition #1"</span>,</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    block <span class="sc">==</span> <span class="dv">3</span> <span class="sc">~</span> <span class="st">"Acquisition #2"</span>,</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    block <span class="sc">==</span> <span class="dv">4</span> <span class="sc">~</span> <span class="st">"Extinction"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">block_named =</span> <span class="fu">factor</span>(block_named, </span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">levels =</span> <span class="fu">c</span>(</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Habituation"</span>,</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Acquisition #1"</span>,</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Acquisition #2"</span>,</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Extinction"</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>  ))) <span class="sc">%&gt;%</span> </span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_quasirandom</span>(<span class="fu">aes</span>(<span class="at">x =</span> cue, <span class="at">y =</span> avg_exp, <span class="at">color =</span> cue)) <span class="sc">+</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>    <span class="sc">~</span>block_named, <span class="at">nrow =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> cue_color) <span class="sc">+</span></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">name =</span> <span class="st">"Shock Expectancy (% chance) Rating"</span>) <span class="sc">+</span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Participant Shock Expectancy Ratings per Cue by Block"</span>) <span class="sc">+</span></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> rating_text_size))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Farkas_HBM_supplemental_workflow_files/figure-html/unnamed-chunk-2-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="shared-by-all-models" class="level1">
<h1>Shared by all models</h1>
<section id="how-missing-amplitude-are-treated" class="level2">
<h2 class="anchored" data-anchor-id="how-missing-amplitude-are-treated">How missing amplitude are treated</h2>
<p>Missing amplitudes are listed as parameters and then are placed into the final array of all possible amplitudes. For the present paper, this is mostly a proof of concept that shows how missing trials are estimated and can be used for model fitting.</p>
<p><span class="math display">\[
\begin{gather}
Amplitude[1 : all \ possible \ trials]\tag{1}\\
Amplitude[indicesObserved]=AmplitudeObserved\tag{2}\\
Amplitude[indicesMissing]=AmplitudeMissing\tag{3}
\end{gather}
\]</span></p>
</section>
<section id="gaussian-error-per-participant" class="level2">
<h2 class="anchored" data-anchor-id="gaussian-error-per-participant">Gaussian error per participant</h2>
<p>For all models, we assume there will be normal/gaussian error <span class="math inline">\(\sigma\)</span> around each prediction <span class="math inline">\(\mu\)</span>. The prediction per trial will depend on the model. The error per-trial was made multilevel so that it could be estimated per participant. In physiological recording, noise is expected to differ between participants. In a previous study (Farkas et al., 2025), this led to a better fitting model in terms of ELPD. It is also informative to the researchers to understand how error changes between participants. Each set of observations was Z-scored within-participants, so we know the error starts at 1, and could be judged from that starting position.</p>
<p><span class="math display">\[
\begin{gather}
Amplitude{[i]} \sim Normal(\mu{[i]},\sigma[participant[i]])\tag{4}\\
\end{gather}
\]</span></p>
</section>
<section id="multilevel-distributions-use-student-t-including-participant-error-estimation" class="level2">
<h2 class="anchored" data-anchor-id="multilevel-distributions-use-student-t-including-participant-error-estimation">Multilevel distributions use Student-T, including participant error estimation</h2>
<p>All multilevel priors used a Student-T distribution with the degrees of freedom parameter equal to number of parameters drawn minus 1. This was done because of the limited sample size (N=24), cues (4), and blocks (4). The Student-T distribution is a normal distribution with slightly heavier tails based on the degrees of freedom. Hypothetically, the degrees of freedom could have been also made a parameter to be estimated. Ultimately, this was not done because it would have added complexity to the interpretability between models. Of course, all deviation parameters where taken from truncated distributions because they cannot be negative. The uninformative prior for <span class="math inline">\(\sigma Average\)</span> was a truncated normal distribution with a mean of 1, and a standard deviation of .5. This is justifiable because we know that before model fit, the average has to be 1 exactly.</p>
<p><span class="math display">\[
\begin{gather}
\sigma[1:nParticipants] \sim StudentT(df = (nParticipants - 1), \ \sigma Average, \ \tau),  \ \sigma \geq 0\tag{5}\\
\sigma Average \sim Normal(1,0.5), \ \sigma Average \geq 0\tag{6}\\
\end{gather}
\]</span></p>
</section>
<section id="deviations-that-can-be-close-to-zero-are-exponetiated" class="level2">
<h2 class="anchored" data-anchor-id="deviations-that-can-be-close-to-zero-are-exponetiated">Deviations that can be close to zero are exponetiated</h2>
<p>Some decisions of parameterization were made because of how the Stan Hamiltonian algorithm works. Generally, it uses Hamiltonian equations of classical mechanics of momentum for Markov Chain Monte Carlo sampling. So, the shape of the distribution sampled can be considered to make the estimation more efficient and accurate. For example, if error differs very little between participants then the <span class="math inline">\(\tau\)</span> parameter specified above could be very close to zero which would be sharp and thus difficult to sample. So instead, parameters that could be very close to zero (but need to be positive) where first sampled as a “raw” variant and then were exponentiated.</p>
<p><span class="math display">\[
\begin{gather}
\tau = exp(\tau Raw)\tag{7}\\
\tau Raw \sim Normal(-3, 1)\tag{8}\\
\end{gather}
\]</span></p>
<p>The chosen raw prior produces this shape, which is justified because we do not expect single trial error to be radically different between models. It ends up being much wider than the found <span class="math inline">\(\tau\)</span> from all models which was close to zero (<span class="math inline">\(\approx 0.03\)</span>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># X ~ exp(Z)</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Z ~ normal(m,s)</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co"># median X is exp(m)</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co"># mean X is exp(m+s^2/2)</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="co"># mode X is exp(m - s^2)</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">0</span>)</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>number_of_samples_plot <span class="ot">&lt;-</span> <span class="dv">20000</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="fu">rnorm</span>(number_of_samples_plot,<span class="sc">-</span><span class="dv">3</span>,<span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">exp</span>() <span class="sc">%&gt;%</span> <span class="co"># transform back to correct scale</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(<span class="at">value =</span> .) <span class="sc">%&gt;%</span> </span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span>.<span class="dv">1</span>,.<span class="dv">5</span>),<span class="at">expand =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># geom_histogram(aes(x = value), bins = 500) +</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(<span class="at">x =</span> value), <span class="at">fill =</span> <span class="st">"gray"</span>) <span class="sc">+</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Farkas_HBM_supplemental_workflow_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="modeling-adaptation-trend-over-trials-model-1" class="level2">
<h2 class="anchored" data-anchor-id="modeling-adaptation-trend-over-trials-model-1">Modeling adaptation trend over trials (Model 1)</h2>
<p>Present in the means per cue by block (Figure 1), there is a downward trend over trials irrespective of block. This is a modeled as a multilevel factor by participant as shown below. Each participant gets their own intercept and slope. For Model 1 in the paper, this is the only prediction made per trial.</p>
<p><span class="math display">\[
\begin{gather}
\mu[i] = intercept[participant[i]] \ + \ adaptation[participant[i]]\cdot trialCentered[i] \ + \ ... \tag{9}\\
\end{gather}
\]</span></p>
<p>Because the observations are Z-scored within-participant, where the mean must be 0, it was recognized that the intercept and slope per participant have to be negatively correlated. So by allowing this relationship to be modeled, everything should fit better and this was the case. So for each participant, each intercept and slope was specified as coming from a multivariate Student-T distribution. What is not shown in the formula below is that the covariance matrix was temporarily “whitened” with a Cholesky decomposition and the multi_student_t_cholesky function was used in Stan. This allows for the model to sample from an uncorrelated version of the data which again helps with Hamiltonian samplers. I opt to build the covariance matrix from its subsequent pieces as I do not like LKJ priors because of how they change when more dimensions are added.</p>
<p><span class="math display">\[
\begin{gather}
\begin{bmatrix}
  intercept[1:nParticipants] \\
  adaptation[1:nParticipants]
\end{bmatrix} \sim MVStudentT \left(
df = (nParticipants - 1),
\begin{bmatrix}
  interceptAverage \\
  adaptationAverage
\end{bmatrix},
\begin{array}{c}
{\huge \Sigma}
\end{array}
\right) \tag{10}\\
\\
\begin{array}{c}
{\huge \Sigma}
\end{array} =
\begin{bmatrix}
\sigma Intercept^2 &amp; \rho \cdot \sigma Intercept \cdot \sigma Adaptation \\
\rho \cdot \sigma Intercept \cdot \sigma Adaptation &amp; \sigma Adaptation^2
\end{bmatrix} \tag{11} \\
\\
interceptAverage \sim Normal(0,0.2)\tag{12} \\
adaptationAverage \sim Normal(0,0.01)\tag{13} \\
\\
\sigma Intercept = exp(\sigma Intercept Raw)\tag{14} \\
\sigma Adaptation = exp(\sigma Adaptation Raw)\tag{15} \\
\rho = tanh(\rho Raw)\tag{16} \\
\\
\sigma Intercept Raw \sim Normal(-1, 1)\tag{17} \\
\sigma Adaptation Raw \sim Normal(-4.5, 0.75)\tag{18} \\
\rho Raw \sim Normal(0, 1)\tag{19} \\
\end{gather}
\]</span></p>
<p>Now I show the prior predictive distributions for the average intercept and slope, the by participant adaptations, and the rationale for the <span class="math inline">\(\rho\)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co">#|echo: false</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="co">#|output: false</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="co">#|message: false</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>model_path <span class="ot">&lt;-</span> <span class="st">'/home/andrewfarkas/Repositories/gaborgen/stan_models/priors_visualization_3.stan'</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="co">#force_recompile = T is sometimes helpful</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>model_priors <span class="ot">&lt;-</span> cmdstanr<span class="sc">::</span><span class="fu">cmdstan_model</span>(model_path, </span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">force_recompile =</span> T)</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="co">#Model source code</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="co"># model_priors$print()</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>model_priors_fit <span class="ot">&lt;-</span> model_priors<span class="sc">$</span><span class="fu">sample</span>(<span class="at">refresh =</span> <span class="dv">1000</span>,</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">seed =</span> <span class="dv">4</span>,</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">iter_warmup =</span> <span class="dv">1000</span>, </span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">iter_sampling =</span> <span class="dv">1000</span>, </span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">save_warmup =</span> F, </span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">show_messages =</span> T,</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>                                        <span class="co"># output_dir = "/home/andrewf/Research_data/EEG/Gaborgen24_EEG_fMRI/stan_chains",</span></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">parallel_chains =</span> <span class="dv">4</span>)</span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>model_priors_fit_summary <span class="ot">&lt;-</span> </span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>  model_priors_fit<span class="sc">$</span><span class="fu">summary</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>A visualization of 100 draws from the priors for the average intercept and adapation slope clearly show it is uninformative and in a reasonable scale fro z-scored data. This is vastly different then the 100 posterior draws shown in Supplemental Figure 1. Note, that I used to call the slope parameter “fatigue” which was not the used term in the manuscript.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>model_priors_fit_df <span class="ot">&lt;-</span> model_priors_fit<span class="sc">$</span><span class="fu">draws</span>(<span class="at">format =</span> <span class="st">"df"</span>)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>number_of_samples_to_plot <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2</span>)</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>samples_to_plot <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(model_priors_fit_df),</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>                          <span class="at">size =</span> number_of_samples_to_plot,</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>                          <span class="at">replace =</span> F)</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>model_priors_fit_df[samples_to_plot,] <span class="sc">%&gt;%</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a><span class="co"># model_priors_fit_df %&gt;% </span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># as.data.frame() %&gt;% </span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># center trial</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># geom_abline(aes(intercept = intercept_average, </span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="fu">aes</span>(<span class="at">intercept =</span> intercept_average <span class="sc">-</span> (fatigue_average <span class="sc">*</span> ((<span class="dv">176</span> <span class="sc">+</span> <span class="dv">1</span>) <span class="sc">/</span><span class="dv">2</span>)), </span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>                  <span class="at">slope =</span> fatigue_average ),</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>              <span class="at">size =</span> .<span class="dv">5</span>, </span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>              <span class="at">alpha =</span> .<span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">4</span>,<span class="dv">4</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">4</span>, <span class="dv">4</span>, <span class="at">by =</span> <span class="dv">1</span>),</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>                     <span class="at">name =</span> <span class="st">"Z-scored ssVEP"</span>) <span class="sc">+</span></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">176</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">176</span>, <span class="at">by =</span> <span class="dv">10</span>),</span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>                     <span class="at">name =</span> <span class="st">"Trials"</span>) <span class="sc">+</span></span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Average Adaptation Prior Predictive regression lines"</span>) <span class="sc">+</span></span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">family =</span> <span class="st">"arial"</span>, <span class="at">size =</span> <span class="dv">15</span>),</span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks.y =</span> <span class="fu">element_blank</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.
ℹ Please use `linewidth` instead.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Farkas_HBM_supplemental_workflow_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The following are visualizations of uninformative priors for the deviation for the intercept and slope between participants. Because this could be close to zero, again it uses the exp() transformation. They are much wider than the estimated posteriors.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">0</span>)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>number_of_samples_plot <span class="ot">&lt;-</span> <span class="dv">20000</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>intercept_sd <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(number_of_samples_plot,<span class="sc">-</span><span class="dv">1</span>,<span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">exp</span>() <span class="sc">%&gt;%</span> <span class="co"># transform back to correct scale</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(<span class="at">value =</span> .)</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="co"># fatigue_sd &lt;- rnorm(number_of_samples_plot,-3,1) %&gt;%</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="co">#   exp() %&gt;% # transform back to correct scale</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="co">#   data.frame(value = .)</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a><span class="co"># fatigue_sd &lt;- rnorm(number_of_samples_plot,-4,.5) %&gt;%</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a><span class="co">#   exp() %&gt;% # transform back to correct scale</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a><span class="co">#   data.frame(value = .)</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>fatigue_sd <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(number_of_samples_plot,<span class="sc">-</span><span class="fl">4.5</span>,.<span class="dv">75</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">exp</span>() <span class="sc">%&gt;%</span> <span class="co"># transform back to correct scale</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(<span class="at">value =</span> .)</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>intercept_sd <span class="sc">%&gt;%</span> </span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span>.<span class="dv">1</span>,<span class="fl">2.5</span>),</span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>                  <span class="at">expand =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">2</span>, <span class="at">by =</span> .<span class="dv">5</span>))<span class="sc">+</span></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>  <span class="co"># geom_histogram(aes(x = value), bins = 500) +</span></span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(<span class="at">x =</span> value), <span class="at">fill =</span> <span class="st">"gray"</span>) <span class="sc">+</span></span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>()) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Farkas_HBM_supplemental_workflow_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>fatigue_sd <span class="sc">%&gt;%</span> </span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span>.<span class="dv">01</span>,.<span class="dv">15</span>),<span class="at">expand =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,.<span class="dv">14</span>, <span class="at">by =</span> .<span class="dv">03</span>))<span class="sc">+</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># geom_histogram(aes(x = value), bins = 500) +</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(<span class="at">x =</span> value), <span class="at">fill =</span> <span class="st">"gray"</span>) <span class="sc">+</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>()) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Farkas_HBM_supplemental_workflow_files/figure-html/unnamed-chunk-6-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The correlation between intercept and adaptation slope, as was expected, was very negative in all models (<span class="math inline">\(\approx-0.99\)</span>). The prior for this correlation was chosen to be close to a uniform distribution between 0 to -1. This was accomplished by specifying it as a normal distribution with a mean of 0 and an SD of 1.75 transformed by an inverse logit function times minus 1. A visualization of the prior can be seen below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>rho <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(number_of_samples_plot,<span class="dv">0</span>,<span class="fl">1.75</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(<span class="at">value =</span> .)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>rho_raw <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(number_of_samples_plot,<span class="dv">0</span>,<span class="fl">1.75</span>) <span class="sc">%&gt;%</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  boot<span class="sc">::</span><span class="fu">inv.logit</span>() <span class="sc">%&gt;%</span> <span class="co"># transform back to correct scale</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(<span class="at">value =</span> <span class="sc">-</span>.)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>rho_raw <span class="sc">%&gt;%</span> </span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">1.1</span>,.<span class="dv">1</span>),<span class="at">expand =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># geom_histogram(aes(x = value), bins = 50) +</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(<span class="at">x =</span> value), <span class="at">fill =</span> <span class="st">"gray"</span>) <span class="sc">+</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="co">#axis.title = element_blank(),</span></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>        <span class="co"># axis.text.y = element_blank(),</span></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Farkas_HBM_supplemental_workflow_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>While it was known there would be a negative correlation between the adaptation intercept and slope, it was unknown how this would differ by participant. Recommended practices (McElreath et al., 2020) would say to visualize the prior predictive to make sure it is uninformative but reasonable. Below is a visualization of what the priors would predict for the difference in adaptation between participants from what ever mean adaptation is found. We can the see the chosen priors are very uninformative to the extentant that they would predict some regression lines that are not reasonable, such as participants with very sharp slopes or drastically different intercepts. However, to make the prior predictive more realistic would have involved biasing the correlation to be even closer to strong negative values and pulling in some of the interecpt and adaptation SD parameters to be even tighter. This would likely look suspicious to reviewers and was not necessary because we have enough high-quality data to overcome these uninformative priors. So ultimately we think these priors are justified for all fit models.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>model_priors_fit_df[samples_to_plot,] <span class="sc">%&gt;%</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="co"># model_priors_fit_df %&gt;% </span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="co">#   as.data.frame() %&gt;%</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="fu">aes</span>(<span class="at">intercept =</span> (intercept <span class="sc">-</span> intercept_average) <span class="sc">-</span> (fatigue <span class="sc">-</span> fatigue_average) <span class="sc">*</span> (<span class="dv">176</span><span class="sc">/</span><span class="dv">2</span>), </span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>                  <span class="at">slope =</span> fatigue <span class="sc">-</span> fatigue_average),</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>              <span class="at">linewidth =</span> .<span class="dv">5</span>, </span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>              <span class="at">alpha =</span> .<span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">4</span>,<span class="dv">4</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">4</span>, <span class="dv">4</span>, <span class="at">by =</span> <span class="dv">1</span>),</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>                     <span class="at">name =</span> <span class="st">"Z-scored ssVEP"</span>) <span class="sc">+</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">176</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">176</span>, <span class="at">by =</span> <span class="dv">10</span>),</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>                     <span class="at">name =</span> <span class="st">"Trials"</span>) <span class="sc">+</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Prior predictive adaptation per participant from mean"</span>) <span class="sc">+</span></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">family =</span> <span class="st">"arial"</span>, <span class="at">size =</span> <span class="dv">15</span>),</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks.y =</span> <span class="fu">element_blank</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Farkas_HBM_supplemental_workflow_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="model-2-cue-by-block" class="level1">
<h1>Model 2: Cue by Block</h1>
<p>Whereas Model 1 only predicts the adaptation per participant, Model 2 adds a prediction per cue by block (2-d array <span class="math inline">\(\beta Cue\)</span>). So, it can be thought of as making a prediction of how cue changes the ssVEP when adaptation is controlled for per participant; kind of like a fancier ANOVA. The <span class="math inline">\(\beta Cue\)</span> prediction is regularized by a multilevel prior which is justified because we do expect the effect of cue to be similar in some ways, and the regularizing toward eachother will act as a correction for multiple comparisons when we want to interpret if they are different. Because there are only a total of 16 conditions, the Student-T distribution is used instead of a normal distribution keeping things consistent between other models. The mean of the Student-T distribution is set to 0 by necessity because other wise the model would be degenerate, meaning the model would not fit because there would be many possible combinations of adaptation and <span class="math inline">\(\beta cue\)</span> that could lead to the same result. So <span class="math inline">\(\beta cue\)</span> pivots around the adaptation line. The same exponentation trick is used for the deviation parameter between cue by block effects.</p>
<p><span class="math display">\[
\begin{gather}
\mu[i] = intercept[participant[i]] \ + \ adaptation[participant[i]]\cdot trial[i] \ + \ \beta Cue[cue[i],block[i]] \tag{20}\\
\beta Cue \sim StudentT(df = (nCues\cdot nBlocks)-1, \ 0, \ \sigma Cue) \tag{21}\\
\sigma Cue = exp(\sigma CueRaw) \tag{22}\\
\sigma CueRaw \sim Normal(-0.5, \ 1.5) \tag{23}\\
\end{gather}
\]</span></p>
<p>The visualization of the <span class="math inline">\(\sigma Cue\)</span> prior is below. It is clearly uninformative when the inner 90% of the found posterior was between .06 to .19. This verges on unrealistic to think that the difference between cue effects could possibly be this large, but there were no problems with model fitting and there was more than enough data to overcome this prior. But because this is the effect of interest, it should be reassuring to reviewers that we are making sure we are not constraining the effect via the prior.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">0</span>)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>number_of_samples_plot <span class="ot">&lt;-</span> <span class="dv">20000</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>cue_sd <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(number_of_samples_plot,<span class="sc">-</span><span class="fl">0.5</span>,<span class="fl">1.5</span>) <span class="sc">%&gt;%</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">exp</span>() <span class="sc">%&gt;%</span> <span class="co"># transform back to correct scale</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(<span class="at">value =</span> .)</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>cue_sd <span class="sc">%&gt;%</span> </span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span>.<span class="dv">1</span>,<span class="dv">5</span>),</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>                  <span class="at">expand =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">10</span>, <span class="at">by =</span> .<span class="dv">5</span>))<span class="sc">+</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">x =</span> value), <span class="at">bins =</span> <span class="dv">1000</span>) <span class="sc">+</span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># geom_density(aes(x = value), fill = "gray") +</span></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Farkas_HBM_supplemental_workflow_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="model-3" class="level1">
<h1>Model 3</h1>
<p>The final model presented in the technical report is a multilevel learning model inspired by the well-known Rescorla-Wagner model equations (Rescorla &amp; Wagner, 1972). The model posits that as surprise increases between the outcome and the expected outcome, change is associate strength is larger scaled by a learning rate. So where <span class="math inline">\(paired\)</span> is the whether the CS+ cue is paired with a US or not (1 or 0), the change in CS+ strength (<span class="math inline">\(1 \ge \Delta CSPStrength \ge 0\)</span>) is based on difference in current CS+ strength <span class="math inline">\(1 \ge CSPStrength[i] \ge 0\)</span> from the current outcome <span class="math inline">\(paired[i]\)</span> times a learning rate.</p>
<p><span class="math display">\[
\begin{gather}
\Delta CSPStrength[i] = LearningRate \cdot (paired[i] - CSPStrength[i]) \tag{24} \\
CSPStrength[i + 1] =  CSPStrength[i] + \Delta CSPStrength[i] \tag{25} \\
\end{gather}
\]</span></p>
<p>This was augmented to to predict the effect of cue allowing the learning rate to differ between participants to predict the ssVEP strength per cue by scaling CS+ strength by the 4-d array <span class="math inline">\(\beta Scaling\)</span>. The following is the best fitting model in terms of Expected Log-likelihood Predictive Density (ELPD) found through the PSIS-LOO method. ELPD is the leave out out cross-validation accuracy, information criteria, and expected log-likelihood of future uncollected data. Cross-validation accuracy is not always the most important feature, as a highly confounded model could have good CV accuracy and maybe some relationships in the data are more important. But according to extremely well-established conjecture from statistics and information theory, the ELPD is a highly sensitive metric of the complete probabilitist distribution of the model and the most credible way of judging a model’s performance against the underlying data generation process (McElreath, 2020 Ch 7).</p>
<p>The best fitting models all used two learning rates per participant, one for paired CS+ trials that had the US (LearningPaired) and for unpaired CS+ trials (LearningUnpaired). So the updating of CS+ strength is different depending on if the CS+ trial was paired with a US or not. This has different theoretical implications than the original Rescorla-Wagner equation. It means that the surprise of an unpaired trial may effect learing different than a paired trial. Below is the complete likelihood function excluding the parts already mention that are shared among all models.</p>
<p><span class="math display">\[
\begin{gather}
\huge \text{Likelihood Function} \\
\\
\mu{[i]} = intercept{[participant[i]]} + adaptation[participant[i]] \cdot trial[i] + \beta Scaling[cue[i]] \cdot CSPStrength[i] \tag{26} \\
\\
\Large \text{if phase[i] is habituation:}\\
CSPStrength[i] = 0 \tag{27} \\
\Delta CSPStrength[i] = 0 \tag{28} \\
CSPStrength[i + 1] = 0 \tag{29} \\
\\
\Large \text{else if cue[i] is CS+ and paired[i] is 1 (US):}\\
\Delta CSPStrength[i] = LearningPaired[participant[i]] \cdot (paired[i] - CSPStrength[i]) \tag{30} \\
CSPStrength[i + 1] =  CSPStrength[i] + \Delta CSPStrength[i] \tag{31} \\
\\
\Large \text{else if cue[i] is CS+ and paired[i] is 0 (no US):}\\
\Delta CSPStrength[i] = LearningUnpaired[participant[i]] \cdot (paired[i] - CSPStrength[i]) \tag{32} \\
CSPStrength[i + 1] =  CSPStrength[i] + \Delta CSPStrength[i] \tag{33} \\
\\
\Large \text{else:}\\
\Delta CSPStrength[i] = 0 \tag{34} \\
CSPStrength[i + 1] =  CSPStrength[i] \tag{35} \\
\end{gather}
\]</span></p>
<p>It can be shown that CS+ strength is fixed at 0 during the initial habituation phase and that no changes are made to CS+ strength when a different cue than the CS+ is shown.</p>
<p>The final learning model that was chose for the manuscript, and had the best ELPD, used the priors below. The difference is that learning rate parameters are first fit on an unbounded normal or Student-T distribution and then transformed to the correct scale using the Inverse Logit function. The Inverse Logit function is mostly known for its use in logistic regression for transforming Log-Odds onto the probabililty scale (0 to 1). As previous mentioned and shown the normal(0,1.75) prior is roughly uniform when tranformed with the Inverse Logit.</p>
<p>Another possible point of contention is the prior for <span class="math inline">\(\beta Scaling\)</span>. Instead of a mean of 0 for the prior like <span class="math inline">\(\beta Cue\)</span> in the second model, there is a parameter for the mean of higher level distribution <span class="math inline">\(\beta Scaling Average\)</span>. The rationale was that the effect of scaling would not be applied to the habituation phase, so this should prevent degeneracy allowing the effect of adaptation to still be found as well. It may have also been possible that the amplitude of all cues may increase with CS+ strength. In actuality, the <span class="math inline">\(\beta Scaling Average\)</span> parameter did mostly fit around zero (mean = .02, SD = .3). It was kept in the model because it allows the model to converge easier and ELPD is higher. It also does not change the <span class="math inline">\(\beta Scaling\)</span> posterior distributions at all.</p>
<p><span class="math display">\[
\begin{gather}
\huge \text{Priors} \\
\\
\beta Scaling[1:nCues] \sim StudentT(df = nCues - 1, \ \beta Scaling Average, \sigma \beta Scaling) \tag{36} \\
\beta Scaling Average \sim Normal(0, 1) \tag{37} \\
\sigma \beta Scaling = exp(\sigma \beta Scaling Raw) \tag{38} \\
\sigma \beta Scaling Raw \sim Normal(-0.5,1.5) \tag{39} \\
\\
LearningPaired[1:nParticipants] = invLogit(LearningPairedRaw[1:nParticipants]) \tag{40} \\
LearningUnpaired[1:nParticipants] = invLogit(LearningUnpairedRaw[1:nParticipants]) \tag{41} \\
LearningPairedRaw[1:nParticipants] \sim StudentT(df = nParticipants-1, \ LearningPairedAverageRaw, \ \sigma LearningPaired)  \tag{42} \\
LearningUnpairedRaw[1:nParticipants] \sim StudentT(df = nParticipants-1, \ LearningUnpairedAverageRaw, \ \sigma LearningUnpaired)  \tag{43} \\
LearningPairedAverageRaw \sim Normal(0,1.75) \tag{44} \\
LearningUnpairedAverageRaw \sim Normal(0,1.75) \tag{45} \\
\sigma LearningPaired = exp(\sigma LearningPairedRaw) \tag{46} \\
\sigma LearningUnpaired = exp(\sigma LearningUnpairedRaw) \tag{47} \\
\sigma LearningPairedRaw \sim Normal(-0.5,1.5) \tag{48} \\
\sigma LearningUnPairedRaw \sim Normal(-0.5,1.5) \tag{49} \\
\end{gather}
\]</span></p>
<p>These final equations describe how the standard error for loo was found and what the equation was for <span class="math inline">\(LOO\text{-}R^2\)</span></p>
<p>For a sum, the equation for a standard error is different than for a mean. The reason we are dealing with sums is because models are fit my maximizing log-likelihoods. When dealing with logarithms often what would have been multiplied is done by addition. ELPD is the approximated sum of LOO log-likelihoods as a reminder.</p>
<p><span class="math display">\[
\begin{gather}
\sqrt{N\cdot variance(PSIS\text{-}LOO)} \tag{50} \\
\end{gather}
\]</span></p>
<p>Although variance explained (<span class="math inline">\(R^2\)</span>) may seem entirely straight-forward, there are different equations that can be used. So here we detail what our definition of <span class="math inline">\(R^2\)</span> is. A consequence, which can also be informative, is that <span class="math inline">\(R^2\)</span> can be negative from this formula. This would mean the models predicts did a worse than making no prediction at all, like drawing a horizontal line through 0 with x-axis being trials. A benefit of a Bayesian <span class="math inline">\(R^2\)</span> is that this metric is also presented as a posterior, so it represent the probability distribution of what the <span class="math inline">\(R^2\)</span> is. Variance explained was found per model, but also per participant. The LOO-residuals are found through a form of Bayesian Bootstrapping using a Dirichlet distribution for resampling. As opposed to normal bootstrapping, or some other forms of Bayesian bootstrapping, instead of resampling data with-replacement, the Dirchelet distribution reweights the data to capture uncertainty in the estimates. By repeating this, a posterior of LOO residuals is found.</p>
<p><span class="math display">\[
\begin{gather}
LOO\text{-}R^2 = 1 - \frac{variance (LOO \ residuals)}{variance (data)} \tag{51} \\
\end{gather}
\]</span></p>
</section>
<section id="supplemental-model-analyses" class="level1">
<h1>Supplemental model analyses</h1>
<p>The suggested practice according to Gelman and McElreath textbooks, is to build and compare a continuous set of models as opposed to just selecting the best one. The rationale is that building from simple to more complex models prevents problems with more sanity checks. Additionally, comparing models can be very informative. In total 8 models were fit the data set in earnest, while we presented three in the main text for clarity within the goals of the manuscript. Yet, as promised, we compare these supplementary models here. Below, each model is described and discussed. Curious readers of course can acquire from github and OSF the posteriors, data, and code for their own questions that I may have not answered here.</p>
<section id="load-relevant-posteriors" class="level2">
<h2 class="anchored" data-anchor-id="load-relevant-posteriors">Load relevant posteriors</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># parent_folder &lt;- "/home/andrewf/Research_data/EEG/Gaborgen24_EEG_fMRI"</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="co"># git_repository &lt;- "/home/andrewfarkas/Repositories/gaborgen"</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="co"># load(file = paste0(parent_folder,"/gaborgen_eeg_manuscript_all_models.RData"))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="model-s1-one-learning-rate-per-participant" class="level2">
<h2 class="anchored" data-anchor-id="model-s1-one-learning-rate-per-participant">Model S1: One learning rate per participant</h2>
<p>This Model is more of a true Rescorla-Wagner model in which only a single learning rate is assigned to each participant. This is the only difference from Model 3, in which participants had two learning rates (learningPaired &amp; learningUnpaired). In terms of cross-validation, this is the second best model overall. However, it still does quite a bit worse than Model 3 (ELPD-Difference = -17.6, SE = 3.8). What is also informative is the the effective parameters (p_loo) is higher for Model S1 (52.4, SE = 1.9) than Model 3 (49.2, SE = 1.8), despite Model 3 having double the learning rates per participant. The effective parameters is essential the penalty term for out of sample (testing) accuracy versus in-sample (training) accuracy. In fact, it is literally the ratio of those two metrics.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># model002_fit_loo # Model S1</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="co"># model003_fit_loo # Model 3</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>loo<span class="sc">::</span><span class="fu">loo_compare</span>(model002_fit_loo,</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>                 model003_fit_loo)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       elpd_diff se_diff
model2   0.0       0.0  
model1 -17.6       3.8  </code></pre>
</div>
</div>
<p>We can visualize this overall cross-validation accuracy between the two models on a log-likelihood scale.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>cue_color <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"red1"</span>,<span class="st">"green1"</span>, <span class="st">"purple1"</span>, <span class="st">"blue1"</span>)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>text_font <span class="ot">&lt;-</span> <span class="st">"Arial"</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>text_size <span class="ot">&lt;-</span> <span class="dv">15</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>axis_line_thickness <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="do">## Overall means and standard errors</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>annotation_text_size <span class="ot">&lt;-</span> <span class="dv">9</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>fig1_dot_size <span class="ot">&lt;-</span> .<span class="dv">8</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>range_linewidth <span class="ot">&lt;-</span> <span class="fl">1.5</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>Oz_fft_df <span class="sc">%&gt;%</span> </span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">participant =</span> participant <span class="sc">%&gt;%</span> <span class="fu">as.factor</span>() <span class="sc">%&gt;%</span> <span class="fu">as.integer</span>() <span class="sc">%&gt;%</span> as.factor) <span class="sc">%&gt;%</span> </span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">model002_elpd =</span> model002_fit_loo<span class="sc">$</span>pointwise[, <span class="st">"elpd_loo"</span>],</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>         <span class="at">model003_elpd =</span> model003_fit_loo<span class="sc">$</span>pointwise[, <span class="st">"elpd_loo"</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="fu">aes</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span> model003_elpd, <span class="at">y =</span> model002_elpd, <span class="at">color =</span> cue), </span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span> .<span class="dv">7</span>, <span class="at">alpha =</span> .<span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> cue_color) <span class="sc">+</span></span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Model 3 ELPD"</span>) <span class="sc">+</span></span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Model S1 ELPD"</span>) <span class="sc">+</span></span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># facet_grid(block~.) +</span></span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Farkas_HBM_supplemental_workflow_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Reusing code from the manuscript, we can still see that Model 3 does better for most cues past the habituation block.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>loo_dot_size <span class="ot">&lt;-</span> .<span class="dv">75</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>loo_dot_alpha <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>loo_par_dot_size <span class="ot">&lt;-</span> .<span class="dv">8</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>loo_par_range_linewidth <span class="ot">&lt;-</span> <span class="fl">1.5</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>loo_figure_text <span class="ot">&lt;-</span><span class="dv">15</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>negative_y <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fl">22.75</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>positive_y <span class="ot">&lt;-</span> <span class="fl">7.5</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>arrow_line_width <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>arrow_size <span class="ot">&lt;-</span> .<span class="dv">5</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>Oz_fft_df <span class="sc">%&gt;%</span> </span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">participant =</span> participant <span class="sc">%&gt;%</span> <span class="fu">as.factor</span>() <span class="sc">%&gt;%</span> <span class="fu">as.integer</span>() <span class="sc">%&gt;%</span> as.factor) <span class="sc">%&gt;%</span> </span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">model002_elpd =</span> model002_fit_loo<span class="sc">$</span>pointwise[, <span class="st">"elpd_loo"</span>],</span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>         <span class="at">model003_elpd =</span> model003_fit_loo<span class="sc">$</span>pointwise[, <span class="st">"elpd_loo"</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">elpd_3_minus_2 =</span> model003_elpd <span class="sc">-</span> model002_elpd) <span class="sc">%&gt;%</span> </span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">elpd_2_minus_3 =</span> model002_elpd <span class="sc">-</span> model003_elpd) <span class="sc">%&gt;%</span> </span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">lik_3_minus_2 =</span> <span class="fu">exp</span>(elpd_3_minus_2)) <span class="sc">%&gt;%</span> </span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">lik_2_minus_3 =</span> <span class="fu">exp</span>(elpd_2_minus_3)) <span class="sc">%&gt;%</span> </span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">p_2_minus_3 =</span> boot<span class="sc">::</span><span class="fu">inv.logit</span>(elpd_2_minus_3)) <span class="sc">%&gt;%</span> </span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">p_3_minus_2 =</span> boot<span class="sc">::</span><span class="fu">inv.logit</span>(elpd_3_minus_2)) <span class="sc">%&gt;%</span> </span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(block, cue) <span class="sc">%&gt;%</span> </span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean_elpd_2_minus_3 =</span> <span class="fu">mean</span>(elpd_2_minus_3),</span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a>            <span class="at">mean_se =</span> plotrix<span class="sc">::</span><span class="fu">std.error</span>(elpd_2_minus_3),</span>
<span id="cb20-27"><a href="#cb20-27" aria-hidden="true" tabindex="-1"></a>            <span class="at">sum_elpd_2_minus_3 =</span> <span class="fu">sum</span>(elpd_2_minus_3),</span>
<span id="cb20-28"><a href="#cb20-28" aria-hidden="true" tabindex="-1"></a>            <span class="at">sum_se =</span> <span class="fu">sqrt</span>(<span class="fu">var</span>(elpd_2_minus_3) <span class="sc">*</span> <span class="fu">n</span>())) <span class="sc">%&gt;%</span> </span>
<span id="cb20-29"><a href="#cb20-29" aria-hidden="true" tabindex="-1"></a>            <span class="co"># sum_se = sd(elpd_2_minus_3) * sqrt(n())) %&gt;% </span></span>
<span id="cb20-30"><a href="#cb20-30" aria-hidden="true" tabindex="-1"></a>            <span class="co"># sum_se = var(elpd_2_minus_3) * sqrt(n())) %&gt;% </span></span>
<span id="cb20-31"><a href="#cb20-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sum_better_for_mod3 =</span> sum_elpd_2_minus_3 <span class="sc">&lt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb20-32"><a href="#cb20-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb20-33"><a href="#cb20-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="fu">aes</span>(<span class="at">xintercept =</span> cue),</span>
<span id="cb20-34"><a href="#cb20-34" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> <span class="st">"lightgray"</span>,</span>
<span id="cb20-35"><a href="#cb20-35" aria-hidden="true" tabindex="-1"></a>             <span class="at">linetype =</span> <span class="st">"dotted"</span>) <span class="sc">+</span></span>
<span id="cb20-36"><a href="#cb20-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="at">yintercept =</span> <span class="dv">0</span>), </span>
<span id="cb20-37"><a href="#cb20-37" aria-hidden="true" tabindex="-1"></a>             <span class="at">linewidth =</span> axis_line_thickness) <span class="sc">+</span></span>
<span id="cb20-38"><a href="#cb20-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>(<span class="fu">aes</span>(<span class="at">x =</span> cue,</span>
<span id="cb20-39"><a href="#cb20-39" aria-hidden="true" tabindex="-1"></a>                      <span class="at">y =</span> sum_elpd_2_minus_3,</span>
<span id="cb20-40"><a href="#cb20-40" aria-hidden="true" tabindex="-1"></a>                      <span class="at">ymin =</span> sum_elpd_2_minus_3 <span class="sc">-</span> sum_se,</span>
<span id="cb20-41"><a href="#cb20-41" aria-hidden="true" tabindex="-1"></a>                      <span class="at">ymax =</span> sum_elpd_2_minus_3 <span class="sc">+</span> sum_se,</span>
<span id="cb20-42"><a href="#cb20-42" aria-hidden="true" tabindex="-1"></a>                      <span class="at">color =</span> sum_better_for_mod3),</span>
<span id="cb20-43"><a href="#cb20-43" aria-hidden="true" tabindex="-1"></a>                  <span class="at">size =</span> loo_par_dot_size,</span>
<span id="cb20-44"><a href="#cb20-44" aria-hidden="true" tabindex="-1"></a>                  <span class="at">linewidth =</span> loo_par_range_linewidth) <span class="sc">+</span></span>
<span id="cb20-45"><a href="#cb20-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(</span>
<span id="cb20-46"><a href="#cb20-46" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> <span class="fu">data.frame</span>(<span class="at">block =</span> <span class="fu">factor</span>(<span class="st">"1"</span>,<span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"1"</span>,<span class="st">"2"</span>, <span class="st">"3"</span>, <span class="st">"4"</span>)), </span>
<span id="cb20-47"><a href="#cb20-47" aria-hidden="true" tabindex="-1"></a>                      <span class="at">x =</span> <span class="fl">0.3</span>, </span>
<span id="cb20-48"><a href="#cb20-48" aria-hidden="true" tabindex="-1"></a>                      <span class="at">xend =</span> <span class="fl">0.3</span>, </span>
<span id="cb20-49"><a href="#cb20-49" aria-hidden="true" tabindex="-1"></a>                      <span class="at">y =</span> <span class="dv">0</span>, <span class="at">yend =</span> positive_y),</span>
<span id="cb20-50"><a href="#cb20-50" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">xend =</span> xend, <span class="at">y =</span> y, <span class="at">yend =</span> yend),</span>
<span id="cb20-51"><a href="#cb20-51" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"red"</span>,</span>
<span id="cb20-52"><a href="#cb20-52" aria-hidden="true" tabindex="-1"></a>    <span class="at">linewidth =</span> arrow_line_width,</span>
<span id="cb20-53"><a href="#cb20-53" aria-hidden="true" tabindex="-1"></a>    <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">length =</span> <span class="fu">unit</span>(arrow_size, <span class="st">"cm"</span>), <span class="at">ends =</span> <span class="st">"last"</span>, <span class="at">type =</span> <span class="st">"closed"</span>),</span>
<span id="cb20-54"><a href="#cb20-54" aria-hidden="true" tabindex="-1"></a>    <span class="at">inherit.aes =</span> <span class="cn">FALSE</span></span>
<span id="cb20-55"><a href="#cb20-55" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb20-56"><a href="#cb20-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(</span>
<span id="cb20-57"><a href="#cb20-57" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> <span class="fu">data.frame</span>(<span class="at">block =</span> <span class="fu">factor</span>(<span class="st">"1"</span>,<span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"1"</span>,<span class="st">"2"</span>, <span class="st">"3"</span>, <span class="st">"4"</span>)), </span>
<span id="cb20-58"><a href="#cb20-58" aria-hidden="true" tabindex="-1"></a>                      <span class="at">x =</span> <span class="fl">0.3</span>, </span>
<span id="cb20-59"><a href="#cb20-59" aria-hidden="true" tabindex="-1"></a>                      <span class="at">xend =</span> <span class="fl">0.3</span>, </span>
<span id="cb20-60"><a href="#cb20-60" aria-hidden="true" tabindex="-1"></a>                      <span class="at">y =</span> <span class="dv">0</span>, <span class="at">yend =</span> negative_y),</span>
<span id="cb20-61"><a href="#cb20-61" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">xend =</span> xend, <span class="at">y =</span> y, <span class="at">yend =</span> yend),</span>
<span id="cb20-62"><a href="#cb20-62" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"blue"</span>,</span>
<span id="cb20-63"><a href="#cb20-63" aria-hidden="true" tabindex="-1"></a>    <span class="at">linewidth =</span> arrow_line_width,</span>
<span id="cb20-64"><a href="#cb20-64" aria-hidden="true" tabindex="-1"></a>    <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">length =</span> <span class="fu">unit</span>(arrow_size, <span class="st">"cm"</span>), <span class="at">ends =</span> <span class="st">"last"</span>, <span class="at">type =</span> <span class="st">"closed"</span>),</span>
<span id="cb20-65"><a href="#cb20-65" aria-hidden="true" tabindex="-1"></a>    <span class="at">inherit.aes =</span> <span class="cn">FALSE</span></span>
<span id="cb20-66"><a href="#cb20-66" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb20-67"><a href="#cb20-67" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>block, <span class="at">nrow =</span> <span class="dv">1</span>, </span>
<span id="cb20-68"><a href="#cb20-68" aria-hidden="true" tabindex="-1"></a>             <span class="at">labeller =</span> <span class="fu">labeller</span>(</span>
<span id="cb20-69"><a href="#cb20-69" aria-hidden="true" tabindex="-1"></a>               <span class="at">block =</span> <span class="fu">c</span>(<span class="st">"1"</span> <span class="ot">=</span> <span class="st">"Habituation"</span>,</span>
<span id="cb20-70"><a href="#cb20-70" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"2"</span> <span class="ot">=</span> <span class="st">"Acquisition #1"</span>,</span>
<span id="cb20-71"><a href="#cb20-71" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"3"</span> <span class="ot">=</span> <span class="st">"Acquisition #2"</span>,</span>
<span id="cb20-72"><a href="#cb20-72" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"4"</span> <span class="ot">=</span> <span class="st">"Extinction"</span>))) <span class="sc">+</span></span>
<span id="cb20-73"><a href="#cb20-73" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_text</span>(<span class="at">data =</span> <span class="fu">data.frame</span>(<span class="at">cue =</span> <span class="fu">c</span>(<span class="fl">2.5</span>),</span>
<span id="cb20-74"><a href="#cb20-74" aria-hidden="true" tabindex="-1"></a>                                <span class="at">elpd_value =</span> <span class="fu">c</span>(<span class="fl">6.75</span>),</span>
<span id="cb20-75"><a href="#cb20-75" aria-hidden="true" tabindex="-1"></a>                                <span class="at">block =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>),</span>
<span id="cb20-76"><a href="#cb20-76" aria-hidden="true" tabindex="-1"></a>                                <span class="at">anno_label =</span> <span class="fu">c</span>(<span class="st">"Habituation"</span>,<span class="st">"Acquisition #1"</span>,<span class="st">"Acquisition #2"</span>,<span class="st">"Extinction"</span>)),</span>
<span id="cb20-77"><a href="#cb20-77" aria-hidden="true" tabindex="-1"></a>              <span class="co"># aes(x = 2.5, y = .5,</span></span>
<span id="cb20-78"><a href="#cb20-78" aria-hidden="true" tabindex="-1"></a>              <span class="co">#   block = "4", label = "CS+")</span></span>
<span id="cb20-79"><a href="#cb20-79" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">x =</span> cue,</span>
<span id="cb20-80"><a href="#cb20-80" aria-hidden="true" tabindex="-1"></a>                  <span class="at">y =</span> elpd_value,</span>
<span id="cb20-81"><a href="#cb20-81" aria-hidden="true" tabindex="-1"></a>                  <span class="at">label =</span> anno_label),</span>
<span id="cb20-82"><a href="#cb20-82" aria-hidden="true" tabindex="-1"></a>              <span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="cb20-83"><a href="#cb20-83" aria-hidden="true" tabindex="-1"></a>              <span class="at">family =</span> <span class="st">"Arial"</span>,</span>
<span id="cb20-84"><a href="#cb20-84" aria-hidden="true" tabindex="-1"></a>              <span class="at">size =</span> <span class="fl">7.5</span> <span class="sc">-</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb20-85"><a href="#cb20-85" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"red1"</span>,<span class="st">"blue1"</span>)) <span class="sc">+</span></span>
<span id="cb20-86"><a href="#cb20-86" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">name =</span> <span class="st">"ELPD Model Difference"</span>) <span class="sc">+</span></span>
<span id="cb20-87"><a href="#cb20-87" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">21.5</span>, <span class="fl">6.5</span>),<span class="at">clip =</span> <span class="st">"off"</span>) <span class="sc">+</span></span>
<span id="cb20-88"><a href="#cb20-88" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">name =</span> <span class="st">"Cue"</span>,<span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"CS+"</span>, <span class="st">"GS1"</span>, <span class="st">"GS2"</span>, <span class="st">"GS3"</span>)) <span class="sc">+</span></span>
<span id="cb20-89"><a href="#cb20-89" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Cross-Validation Accuracy by Cue and Block"</span>) <span class="sc">+</span></span>
<span id="cb20-90"><a href="#cb20-90" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb20-91"><a href="#cb20-91" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">family =</span> text_font,</span>
<span id="cb20-92"><a href="#cb20-92" aria-hidden="true" tabindex="-1"></a>                            <span class="at">size =</span> loo_figure_text <span class="sc">-</span><span class="dv">2</span>,</span>
<span id="cb20-93"><a href="#cb20-93" aria-hidden="true" tabindex="-1"></a>                            <span class="at">color =</span> <span class="st">"black"</span>),</span>
<span id="cb20-94"><a href="#cb20-94" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">linewidth =</span> axis_line_thickness,</span>
<span id="cb20-95"><a href="#cb20-95" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">lineend =</span> <span class="st">"square"</span>),</span>
<span id="cb20-96"><a href="#cb20-96" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.line.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb20-97"><a href="#cb20-97" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb20-98"><a href="#cb20-98" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb20-99"><a href="#cb20-99" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.text =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb20-100"><a href="#cb20-100" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb20-101"><a href="#cb20-101" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb20-102"><a href="#cb20-102" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">color =</span> cue_color,<span class="at">angle =</span> <span class="dv">15</span>,<span class="at">vjust =</span> .<span class="dv">85</span>)</span>
<span id="cb20-103"><a href="#cb20-103" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'block'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Vectorized input to `element_text()` is not officially supported.
ℹ Results may be unexpected or may change in future versions of ggplot2.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Combining variables of class &lt;numeric&gt; and &lt;factor&gt; was deprecated in ggplot2
3.4.0.
ℹ Please ensure your variables are compatible before plotting (location:
  `combine_vars()`)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Combining variables of class &lt;factor&gt; and &lt;numeric&gt; was deprecated in ggplot2
3.4.0.
ℹ Please ensure your variables are compatible before plotting (location:
  `combine_vars()`)</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Farkas_HBM_supplemental_workflow_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Most participants are also better explained by Model 3.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>Oz_fft_df <span class="sc">%&gt;%</span> </span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">participant =</span> participant <span class="sc">%&gt;%</span> <span class="fu">as.factor</span>() <span class="sc">%&gt;%</span> <span class="fu">as.integer</span>() <span class="sc">%&gt;%</span> as.factor) <span class="sc">%&gt;%</span> </span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">model002_elpd =</span> model002_fit_loo<span class="sc">$</span>pointwise[, <span class="st">"elpd_loo"</span>],</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">model003_elpd =</span> model003_fit_loo<span class="sc">$</span>pointwise[, <span class="st">"elpd_loo"</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">elpd_3_minus_2 =</span> model003_elpd <span class="sc">-</span> model002_elpd) <span class="sc">%&gt;%</span> </span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">elpd_2_minus_3 =</span> model002_elpd <span class="sc">-</span> model003_elpd) <span class="sc">%&gt;%</span> </span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">lik_3_minus_2 =</span> <span class="fu">exp</span>(elpd_3_minus_2)) <span class="sc">%&gt;%</span> </span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">lik_2_minus_3 =</span> <span class="fu">exp</span>(elpd_2_minus_3)) <span class="sc">%&gt;%</span> </span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">p_2_minus_3 =</span> boot<span class="sc">::</span><span class="fu">inv.logit</span>(elpd_2_minus_3)) <span class="sc">%&gt;%</span> </span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">p_3_minus_2 =</span> boot<span class="sc">::</span><span class="fu">inv.logit</span>(elpd_3_minus_2)) <span class="sc">%&gt;%</span> </span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(participant) <span class="sc">%&gt;%</span> </span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean_elpd_2_minus_3 =</span> <span class="fu">mean</span>(elpd_2_minus_3),</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>            <span class="at">mean_se =</span> plotrix<span class="sc">::</span><span class="fu">std.error</span>(elpd_2_minus_3),</span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>            <span class="at">sum_elpd_2_minus_3 =</span> <span class="fu">sum</span>(elpd_2_minus_3),</span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>            <span class="at">sum_se =</span> <span class="fu">sqrt</span>(<span class="fu">var</span>(elpd_2_minus_3) <span class="sc">*</span> <span class="fu">n</span>())) <span class="sc">%&gt;%</span> </span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>            <span class="co"># sum_se = sd(elpd_2_minus_3) * sqrt(n())) %&gt;% </span></span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>            <span class="co"># sum_se = var(elpd_2_minus_3) * sqrt(n())) %&gt;% </span></span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sum_better_for_mod3 =</span> sum_elpd_2_minus_3 <span class="sc">&lt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="fu">aes</span>(<span class="at">xintercept =</span> participant),</span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> <span class="st">"lightgray"</span>,</span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a>             <span class="at">linetype =</span> <span class="st">"dotted"</span>) <span class="sc">+</span></span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="at">yintercept =</span> <span class="dv">0</span>), </span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a>             <span class="at">linewidth =</span> axis_line_thickness) <span class="sc">+</span></span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>(<span class="fu">aes</span>(<span class="at">x =</span> participant,</span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true" tabindex="-1"></a>                      <span class="at">y =</span> sum_elpd_2_minus_3,</span>
<span id="cb25-27"><a href="#cb25-27" aria-hidden="true" tabindex="-1"></a>                      <span class="at">ymin =</span> sum_elpd_2_minus_3 <span class="sc">-</span> sum_se,</span>
<span id="cb25-28"><a href="#cb25-28" aria-hidden="true" tabindex="-1"></a>                      <span class="at">ymax =</span> sum_elpd_2_minus_3 <span class="sc">+</span> sum_se,</span>
<span id="cb25-29"><a href="#cb25-29" aria-hidden="true" tabindex="-1"></a>                      <span class="at">color =</span> sum_better_for_mod3),</span>
<span id="cb25-30"><a href="#cb25-30" aria-hidden="true" tabindex="-1"></a>                  <span class="at">size =</span> loo_par_dot_size,</span>
<span id="cb25-31"><a href="#cb25-31" aria-hidden="true" tabindex="-1"></a>                  <span class="at">linewidth =</span> loo_par_range_linewidth) <span class="sc">+</span></span>
<span id="cb25-32"><a href="#cb25-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"text"</span>, </span>
<span id="cb25-33"><a href="#cb25-33" aria-hidden="true" tabindex="-1"></a>             <span class="at">x =</span> <span class="dv">19</span>, </span>
<span id="cb25-34"><a href="#cb25-34" aria-hidden="true" tabindex="-1"></a>             <span class="at">y =</span> <span class="sc">-</span><span class="fl">15.5</span>,</span>
<span id="cb25-35"><a href="#cb25-35" aria-hidden="true" tabindex="-1"></a>             <span class="at">label =</span> <span class="st">"Model S1 Better"</span>,</span>
<span id="cb25-36"><a href="#cb25-36" aria-hidden="true" tabindex="-1"></a>             <span class="at">family =</span> <span class="st">"Arial"</span>,</span>
<span id="cb25-37"><a href="#cb25-37" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> <span class="st">"red1"</span>,</span>
<span id="cb25-38"><a href="#cb25-38" aria-hidden="true" tabindex="-1"></a>             <span class="at">lineheight =</span> <span class="fl">0.8</span>, <span class="co"># Adjust this value to decrease spacing</span></span>
<span id="cb25-39"><a href="#cb25-39" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span> <span class="dv">12-5</span>)<span class="sc">+</span></span>
<span id="cb25-40"><a href="#cb25-40" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"text"</span>, </span>
<span id="cb25-41"><a href="#cb25-41" aria-hidden="true" tabindex="-1"></a>             <span class="at">x =</span> <span class="dv">19</span>, </span>
<span id="cb25-42"><a href="#cb25-42" aria-hidden="true" tabindex="-1"></a>             <span class="at">y =</span> <span class="sc">-</span><span class="dv">20</span>,</span>
<span id="cb25-43"><a href="#cb25-43" aria-hidden="true" tabindex="-1"></a>             <span class="at">label =</span> <span class="st">"Model 3 Better"</span>,</span>
<span id="cb25-44"><a href="#cb25-44" aria-hidden="true" tabindex="-1"></a>             <span class="at">family =</span> <span class="st">"Arial"</span>,</span>
<span id="cb25-45"><a href="#cb25-45" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> <span class="st">"blue1"</span>,</span>
<span id="cb25-46"><a href="#cb25-46" aria-hidden="true" tabindex="-1"></a>             <span class="at">lineheight =</span> <span class="fl">0.8</span>, <span class="co"># Adjust this value to decrease spacing</span></span>
<span id="cb25-47"><a href="#cb25-47" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span> <span class="dv">12-5</span>)<span class="sc">+</span></span>
<span id="cb25-48"><a href="#cb25-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"red1"</span>,<span class="st">"blue1"</span>)) <span class="sc">+</span></span>
<span id="cb25-49"><a href="#cb25-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">name =</span> <span class="st">"ELPD Model Difference"</span>) <span class="sc">+</span></span>
<span id="cb25-50"><a href="#cb25-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">21.5</span>, <span class="fl">6.5</span>), , <span class="at">clip =</span> <span class="st">"off"</span>) <span class="sc">+</span></span>
<span id="cb25-51"><a href="#cb25-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">name =</span> <span class="st">"Participant"</span>) <span class="sc">+</span></span>
<span id="cb25-52"><a href="#cb25-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Cross-Validation Accuracy by Participant"</span>) <span class="sc">+</span></span>
<span id="cb25-53"><a href="#cb25-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb25-54"><a href="#cb25-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">family =</span> text_font,</span>
<span id="cb25-55"><a href="#cb25-55" aria-hidden="true" tabindex="-1"></a>                            <span class="at">size =</span> loo_figure_text,</span>
<span id="cb25-56"><a href="#cb25-56" aria-hidden="true" tabindex="-1"></a>                            <span class="at">color =</span> <span class="st">"black"</span>),</span>
<span id="cb25-57"><a href="#cb25-57" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">linewidth =</span> axis_line_thickness,</span>
<span id="cb25-58"><a href="#cb25-58" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">lineend =</span> <span class="st">"square"</span>),</span>
<span id="cb25-59"><a href="#cb25-59" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb25-60"><a href="#cb25-60" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb25-61"><a href="#cb25-61" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.line.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb25-62"><a href="#cb25-62" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"none"</span></span>
<span id="cb25-63"><a href="#cb25-63" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb25-64"><a href="#cb25-64" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Same “two-piece” arrow for y-axis</span></span>
<span id="cb25-65"><a href="#cb25-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(</span>
<span id="cb25-66"><a href="#cb25-66" aria-hidden="true" tabindex="-1"></a>    <span class="st">"segment"</span>,</span>
<span id="cb25-67"><a href="#cb25-67" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="fl">0.3</span>, </span>
<span id="cb25-68"><a href="#cb25-68" aria-hidden="true" tabindex="-1"></a>    <span class="at">xend =</span> <span class="fl">0.3</span>, </span>
<span id="cb25-69"><a href="#cb25-69" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="dv">0</span>, <span class="at">yend =</span> positive_y,</span>
<span id="cb25-70"><a href="#cb25-70" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"red"</span>,</span>
<span id="cb25-71"><a href="#cb25-71" aria-hidden="true" tabindex="-1"></a>    <span class="at">linewidth  =</span> arrow_line_width,</span>
<span id="cb25-72"><a href="#cb25-72" aria-hidden="true" tabindex="-1"></a>    <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">length =</span> <span class="fu">unit</span>(arrow_size, <span class="st">"cm"</span>), <span class="at">ends =</span> <span class="st">"last"</span>, <span class="at">type =</span> <span class="st">"closed"</span>)</span>
<span id="cb25-73"><a href="#cb25-73" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb25-74"><a href="#cb25-74" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(</span>
<span id="cb25-75"><a href="#cb25-75" aria-hidden="true" tabindex="-1"></a>    <span class="st">"segment"</span>,</span>
<span id="cb25-76"><a href="#cb25-76" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="fl">0.3</span>, </span>
<span id="cb25-77"><a href="#cb25-77" aria-hidden="true" tabindex="-1"></a>    <span class="at">xend =</span> <span class="fl">0.3</span>, </span>
<span id="cb25-78"><a href="#cb25-78" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="dv">0</span>, <span class="at">yend =</span> negative_y,</span>
<span id="cb25-79"><a href="#cb25-79" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"blue"</span>,</span>
<span id="cb25-80"><a href="#cb25-80" aria-hidden="true" tabindex="-1"></a>    <span class="at">linewidth  =</span> arrow_line_width,</span>
<span id="cb25-81"><a href="#cb25-81" aria-hidden="true" tabindex="-1"></a>    <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">length =</span> <span class="fu">unit</span>(arrow_size, <span class="st">"cm"</span>), <span class="at">ends =</span> <span class="st">"last"</span>, <span class="at">type =</span> <span class="st">"closed"</span>)</span>
<span id="cb25-82"><a href="#cb25-82" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Farkas_HBM_supplemental_workflow_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<!-- ```{r} -->
<!-- Oz_fft_df %>%  -->
<!--   mutate(participant = participant %>% as.factor() %>% as.integer() %>% as.factor) %>%  -->
<!--   mutate(model002_elpd = model002_fit_loo$pointwise[, "elpd_loo"], -->
<!--          model003_elpd = model003_fit_loo$pointwise[, "elpd_loo"]) %>%  -->
<!--   mutate(elpd_3_minus_2 = model003_elpd - model002_elpd) %>%  -->
<!--   mutate(elpd_2_minus_3 = model002_elpd - model003_elpd) %>%  -->
<!--   mutate(lik_3_minus_2 = exp(elpd_3_minus_2)) %>%  -->
<!--   mutate(lik_2_minus_3 = exp(elpd_2_minus_3)) %>%  -->
<!--   mutate(p_2_minus_3 = boot::inv.logit(elpd_2_minus_3)) %>%  -->
<!--   mutate(p_3_minus_2 = boot::inv.logit(elpd_3_minus_2)) %>%  -->
<!--   arrange(desc(lik_3_minus_2)) %>%  -->
<!--   mutate(block = factor(block, levels = c(1:4))) %>%  -->
<!--   ggplot() + -->
<!--   geom_abline(aes(intercept = 1, slope = 0)) + -->
<!--   geom_point(aes(x= 1:nrow(Oz_fft_df),  -->
<!--                  # y = lik_2_minus_3, -->
<!--                  # y = p_3_minus_2, -->
<!--                  y = elpd_3_minus_2, -->
<!--                  # y = elpd_2_minus_3, -->
<!--                  color = cue),  -->
<!--              size = .7) + -->
<!--   scale_color_manual(values = cue_color) + -->
<!--   # scale_y_continuous(breaks = seq(.6, 2.4, by = .2) ) + -->
<!--   xlab("Observations Sorted by Likelihood") + -->
<!--   ylab("CV-Likelihood Ratio: Model 3 over S1") + -->
<!--   # facet_grid(block~.) + -->
<!--   theme_bw() + -->
<!--   theme() -->
<!-- hold <- seq(.6, 2.4, by = .2) -->
<!-- hold/(hold - 1) -->
<!-- ``` -->
<p>And the model weights suggest the best cross-validation accuracy would entirely rely on predictions from Model 3, not averaging prediction between the two model in anyway. This all suggest that Model 3 is consistently better than Model S1.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>loo<span class="sc">::</span><span class="fu">loo_model_weights</span>(<span class="fu">list</span>(model002_fit_loo,</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>                            model003_fit_loo))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Method: stacking
------
       weight
model1 0.000 
model2 1.000 </code></pre>
</div>
</div>
<p>If we examine the relevant posteriors closer, we can get some clues why Model S1 does worse than Model 3. We can see that almost all of the learning rates are extremely close to zero.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>model002_fit_learning_rate_posteriors <span class="sc">%&gt;%</span> </span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">starts_with</span>(<span class="st">"learning"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">factor</span>(name, <span class="at">levels =</span> <span class="fu">rev</span>(<span class="fu">unique</span>(name)))) <span class="sc">%&gt;%</span> </span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value, </span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">y =</span> name)) <span class="sc">+</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_density_ridges</span>(<span class="at">fill =</span> <span class="st">"black"</span>,</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>                      <span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>                      <span class="at">scale =</span> <span class="dv">1</span>,</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>                      <span class="at">rel_min_height =</span> <span class="fl">0.01</span>,</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>                      <span class="at">from =</span> <span class="dv">0</span>,</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>                      <span class="at">panel_scaling =</span> <span class="cn">FALSE</span>,</span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>                      <span class="at">to =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Dropping 'draws_df' class as required metadata was removed.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Picking joint bandwidth of 0.000945</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Farkas_HBM_supplemental_workflow_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>This results in the CS+ strength not getting close to 1 for any of the participants.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>number_of_samples_to_plot <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="co"># number_of_samples_to_plot &lt;- 4000</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">0</span>)</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>samples_to_plot <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">80000</span>),</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>                          <span class="at">size =</span> number_of_samples_to_plot,</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>                          <span class="at">replace =</span> F)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>CSP_plot_df <span class="ot">&lt;-</span> CSP_df <span class="sc">%&gt;%</span> </span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">starts_with</span>(<span class="st">"CSP_ass"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">factor</span>(name, <span class="at">levels =</span> <span class="fu">unique</span>(name))) <span class="sc">%&gt;%</span> </span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">participant =</span> <span class="fu">rep</span>(gaborgen_stan_list<span class="sc">$</span>participant, </span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">nrow</span>(CSP_df)),</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">trial =</span> <span class="fu">rep</span>(gaborgen_stan_list<span class="sc">$</span>trial, </span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">nrow</span>(CSP_df)),</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">cue =</span> <span class="fu">rep</span>(gaborgen_stan_list<span class="sc">$</span>cue, </span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">nrow</span>(CSP_df))) <span class="sc">%&gt;%</span> </span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(participant, trial) <span class="sc">%&gt;%</span> </span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mean_value =</span> <span class="fu">mean</span>(value),</span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">median_value =</span> <span class="fu">median</span>(value),<span class="at">.before =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(.draw <span class="sc">%in%</span> samples_to_plot)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Dropping 'draws_df' class as required metadata was removed.</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>par_axis_line_thickness <span class="ot">&lt;-</span> .<span class="dv">75</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>text_size <span class="ot">&lt;-</span> <span class="dv">15</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>line_width_csp <span class="ot">&lt;-</span> .<span class="dv">25</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>line_alpha_csp <span class="ot">&lt;-</span> .<span class="dv">25</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>line_width_csp_average <span class="ot">&lt;-</span> <span class="fl">1.5</span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>CSP_plot_df <span class="sc">%&gt;%</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="co">#participant %in% c(1,2,3),</span></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>    trial <span class="sc">&gt;=</span> <span class="dv">30</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">32</span> <span class="sc">+</span> <span class="dv">48</span> <span class="sc">+</span> <span class="dv">48</span>,</span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> trial, </span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>                <span class="at">y =</span> value, </span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>                <span class="at">group =</span> .draw),</span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>            <span class="at">linewidth =</span> line_width_csp,</span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a>            <span class="at">alpha =</span> line_alpha_csp) <span class="sc">+</span></span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> trial, </span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a>                <span class="at">y =</span> median_value),</span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a>            <span class="at">linewidth =</span> line_width_csp_average,</span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a>            <span class="co"># alpha = line_alpha_csp,</span></span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> <span class="st">"red"</span></span>
<span id="cb34-23"><a href="#cb34-23" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb34-24"><a href="#cb34-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">40</span>,<span class="dv">180</span>, <span class="at">by =</span> <span class="dv">20</span>),</span>
<span id="cb34-25"><a href="#cb34-25" aria-hidden="true" tabindex="-1"></a>                     <span class="at">name =</span> <span class="st">"Trial"</span>) <span class="sc">+</span></span>
<span id="cb34-26"><a href="#cb34-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.05</span>,<span class="fl">1.05</span>),<span class="at">expand =</span> F) <span class="sc">+</span></span>
<span id="cb34-27"><a href="#cb34-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb34-28"><a href="#cb34-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(participant <span class="sc">~</span>., </span>
<span id="cb34-29"><a href="#cb34-29" aria-hidden="true" tabindex="-1"></a>             <span class="co"># scales = "free_y",</span></span>
<span id="cb34-30"><a href="#cb34-30" aria-hidden="true" tabindex="-1"></a>             <span class="at">space =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb34-31"><a href="#cb34-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Associate Value Posterior Draws and Median"</span>) <span class="sc">+</span></span>
<span id="cb34-32"><a href="#cb34-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">family =</span> <span class="st">"Arial"</span>,</span>
<span id="cb34-33"><a href="#cb34-33" aria-hidden="true" tabindex="-1"></a>                            <span class="at">size =</span> text_size),</span>
<span id="cb34-34"><a href="#cb34-34" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb34-35"><a href="#cb34-35" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.text =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb34-36"><a href="#cb34-36" aria-hidden="true" tabindex="-1"></a>        <span class="co"># strip.text.y = element_blank(),</span></span>
<span id="cb34-37"><a href="#cb34-37" aria-hidden="true" tabindex="-1"></a>        <span class="co"># panel.spacing = unit(0, "lines"),</span></span>
<span id="cb34-38"><a href="#cb34-38" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.spacing =</span> <span class="fu">unit</span>(<span class="fl">0.15</span>, <span class="st">"lines"</span>),</span>
<span id="cb34-39"><a href="#cb34-39" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.line =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb34-40"><a href="#cb34-40" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb34-41"><a href="#cb34-41" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb34-42"><a href="#cb34-42" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb34-43"><a href="#cb34-43" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> .<span class="dv">5</span>,<span class="at">vjust =</span> <span class="fl">0.1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Farkas_HBM_supplemental_workflow_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>This has an interesting effect on the scaling parameters per cue, they are much wider than Model 3.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>model002_fit_scaling_posteriors <span class="sc">%&gt;%</span> </span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">starts_with</span>(<span class="st">"scaling"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">factor</span>(name, <span class="at">levels =</span> (<span class="fu">unique</span>(name)))) <span class="sc">%&gt;%</span> </span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(<span class="at">x =</span> value,</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>                   <span class="at">color =</span> name,</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>                   <span class="at">fill =</span> name),</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>               <span class="at">linewidth =</span> <span class="dv">1</span>,</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>               <span class="at">alpha =</span> .<span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">5</span>,<span class="dv">5</span>,<span class="at">by =</span> <span class="dv">1</span>), <span class="at">name =</span> <span class="st">"Δ Z-Scored ssVEP"</span>) <span class="sc">+</span></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> cue_color) <span class="sc">+</span></span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> cue_color) <span class="sc">+</span></span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">5</span>,<span class="dv">5</span>)) <span class="sc">+</span></span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Dropping 'draws_df' class as required metadata was removed.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Farkas_HBM_supplemental_workflow_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>These scaling parameters are much harder to interpret because no participants reach a maximum associate strength of 1. So this would be the change in the ssVEP for a level of learning that no one reaches. This is hard to reconcile with our understanding that it is likely that at least some of the participants should learn the relationship. This model predicts flat responses for most participants, with some having gradual increases in acquisition and gradual decreases in extinction. Maybe this would be plausible that the ssVEP response slowly ramps up at different rates for different participants, but then it should have better CV-accuracy compared to Model 3 in some of the experimental blocks. All the CV-metrics suggest that this model performs worse and overfits. This mixed with the strange scaling posteriors sums up the reasons for why this model was not discussed in the manuscript.</p>
</section>
<section id="model-s2-model-3-with-beta-priors-on-learning-rates" class="level2">
<h2 class="anchored" data-anchor-id="model-s2-model-3-with-beta-priors-on-learning-rates">Model S2: Model 3 with beta priors on learning rates</h2>
<p>After seeing the results of Model 3, we wanted to make sure that the inverse logit transformation of learning rates was not distorting our understanding of the data. The inverse logit was used to help with model fitting, we were not aware that it would lead to such stark all or nothing learning rates per participant. So Model S2 uses different beta(1.1,1.1) uninformative priors for the learning_paired_average and learning_unpaired_average hyperparameters. While this model converges, similar to Model S1 it predicts gradual changes with most learning paired rates close to zero. The unpaired learning rate is very wide for most participants.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>model004_fit_learning_rate_posteriors <span class="sc">%&gt;%</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">"learning_paired["</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">everything</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">factor</span>(name,</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>                       <span class="at">levels =</span> <span class="fu">unique</span>(name))) <span class="sc">%&gt;%</span> </span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value, </span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>             <span class="at">y =</span> <span class="fu">factor</span>(name, </span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>                        <span class="at">levels =</span> <span class="fu">rev</span>(<span class="fu">levels</span>(name)))</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">+</span></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">24</span>),</span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>             <span class="at">linewidth =</span> par_axis_line_thickness,</span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>             <span class="at">linetype =</span> <span class="st">"dashed"</span>,</span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> <span class="st">"gray"</span>)<span class="sc">+</span></span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># geom_density_ridges(aes(height = after_stat(scaled)),</span></span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                     fill = "black",</span></span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                     scale = .9,</span></span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                     stat = "density",</span></span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                     # rel_min_height = 0.01,</span></span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                     # from = 0,</span></span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                     # to = 1,</span></span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                     panel_scaling = FALSE) +</span></span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_density_ridges</span>(<span class="at">fill =</span> <span class="st">"black"</span>,</span>
<span id="cb37-23"><a href="#cb37-23" aria-hidden="true" tabindex="-1"></a>                      <span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="cb37-24"><a href="#cb37-24" aria-hidden="true" tabindex="-1"></a>                      <span class="at">scale =</span> <span class="dv">1</span>,</span>
<span id="cb37-25"><a href="#cb37-25" aria-hidden="true" tabindex="-1"></a>                      <span class="at">rel_min_height =</span> <span class="fl">0.01</span>,</span>
<span id="cb37-26"><a href="#cb37-26" aria-hidden="true" tabindex="-1"></a>                      <span class="at">from =</span> <span class="dv">0</span>,</span>
<span id="cb37-27"><a href="#cb37-27" aria-hidden="true" tabindex="-1"></a>                      <span class="at">panel_scaling =</span> <span class="cn">FALSE</span>,</span>
<span id="cb37-28"><a href="#cb37-28" aria-hidden="true" tabindex="-1"></a>                      <span class="at">to =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb37-29"><a href="#cb37-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>(<span class="at">labels =</span> <span class="fu">paste0</span>(<span class="st">"Participant "</span>, </span>
<span id="cb37-30"><a href="#cb37-30" aria-hidden="true" tabindex="-1"></a>                                   gaborgen_stan_list<span class="sc">$</span>n_participants<span class="sc">:</span><span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb37-31"><a href="#cb37-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>, <span class="at">by =</span> .<span class="dv">5</span>),</span>
<span id="cb37-32"><a href="#cb37-32" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"0"</span>, <span class="st">".5"</span>, <span class="st">"1"</span>)) <span class="sc">+</span></span>
<span id="cb37-33"><a href="#cb37-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="co">#xlim = c(-0.01,1.01), </span></span>
<span id="cb37-34"><a href="#cb37-34" aria-hidden="true" tabindex="-1"></a>                  <span class="at">expand =</span> <span class="dv">0</span>,</span>
<span id="cb37-35"><a href="#cb37-35" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">25</span>))<span class="sc">+</span></span>
<span id="cb37-36"><a href="#cb37-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Learn Paired"</span>) <span class="sc">+</span></span>
<span id="cb37-37"><a href="#cb37-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb37-38"><a href="#cb37-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">family =</span> <span class="st">"Arial"</span>,</span>
<span id="cb37-39"><a href="#cb37-39" aria-hidden="true" tabindex="-1"></a>                            <span class="at">size =</span> text_size),</span>
<span id="cb37-40"><a href="#cb37-40" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb37-41"><a href="#cb37-41" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">vjust =</span> <span class="sc">-</span>.<span class="dv">5</span>),</span>
<span id="cb37-42"><a href="#cb37-42" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb37-43"><a href="#cb37-43" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> .<span class="dv">5</span>,<span class="at">vjust =</span> <span class="dv">0</span>)) <span class="sc">|</span></span>
<span id="cb37-44"><a href="#cb37-44" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-45"><a href="#cb37-45" aria-hidden="true" tabindex="-1"></a>  model004_fit_learning_rate_posteriors <span class="sc">%&gt;%</span></span>
<span id="cb37-46"><a href="#cb37-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">"learning_unpaired["</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb37-47"><a href="#cb37-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">everything</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb37-48"><a href="#cb37-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">factor</span>(name,</span>
<span id="cb37-49"><a href="#cb37-49" aria-hidden="true" tabindex="-1"></a>                       <span class="at">levels =</span> <span class="fu">unique</span>(name))) <span class="sc">%&gt;%</span> </span>
<span id="cb37-50"><a href="#cb37-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">y =</span> <span class="fu">factor</span>(name, <span class="at">levels =</span> <span class="fu">rev</span>(<span class="fu">levels</span>(name))))) <span class="sc">+</span></span>
<span id="cb37-51"><a href="#cb37-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">24</span>),</span>
<span id="cb37-52"><a href="#cb37-52" aria-hidden="true" tabindex="-1"></a>             <span class="at">linewidth =</span> par_axis_line_thickness,</span>
<span id="cb37-53"><a href="#cb37-53" aria-hidden="true" tabindex="-1"></a>             <span class="at">linetype =</span> <span class="st">"dashed"</span>,</span>
<span id="cb37-54"><a href="#cb37-54" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> <span class="st">"gray"</span>)<span class="sc">+</span></span>
<span id="cb37-55"><a href="#cb37-55" aria-hidden="true" tabindex="-1"></a>  <span class="co"># geom_density_ridges(aes(height = after_stat(scaled)),</span></span>
<span id="cb37-56"><a href="#cb37-56" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                     fill = "black",</span></span>
<span id="cb37-57"><a href="#cb37-57" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                     scale = .9,</span></span>
<span id="cb37-58"><a href="#cb37-58" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                     stat = "density",</span></span>
<span id="cb37-59"><a href="#cb37-59" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                     # rel_min_height = 0.01,</span></span>
<span id="cb37-60"><a href="#cb37-60" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                     # from = 0,</span></span>
<span id="cb37-61"><a href="#cb37-61" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                     # to = 1,</span></span>
<span id="cb37-62"><a href="#cb37-62" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                     panel_scaling = FALSE) +</span></span>
<span id="cb37-63"><a href="#cb37-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_density_ridges</span>(<span class="at">fill =</span> <span class="st">"black"</span>,</span>
<span id="cb37-64"><a href="#cb37-64" aria-hidden="true" tabindex="-1"></a>                      <span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="cb37-65"><a href="#cb37-65" aria-hidden="true" tabindex="-1"></a>                      <span class="at">scale =</span> <span class="dv">1</span>,</span>
<span id="cb37-66"><a href="#cb37-66" aria-hidden="true" tabindex="-1"></a>                      <span class="at">rel_min_height =</span> <span class="fl">0.01</span>,</span>
<span id="cb37-67"><a href="#cb37-67" aria-hidden="true" tabindex="-1"></a>                      <span class="at">panel_scaling =</span> <span class="cn">FALSE</span>,</span>
<span id="cb37-68"><a href="#cb37-68" aria-hidden="true" tabindex="-1"></a>                      <span class="at">from =</span> <span class="dv">0</span>,</span>
<span id="cb37-69"><a href="#cb37-69" aria-hidden="true" tabindex="-1"></a>                      <span class="at">to =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb37-70"><a href="#cb37-70" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>(<span class="at">labels =</span> <span class="fu">paste0</span>(<span class="st">"Participant "</span>, </span>
<span id="cb37-71"><a href="#cb37-71" aria-hidden="true" tabindex="-1"></a>                                   gaborgen_stan_list<span class="sc">$</span>n_participants<span class="sc">:</span><span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb37-72"><a href="#cb37-72" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>, <span class="at">by =</span> .<span class="dv">5</span>),</span>
<span id="cb37-73"><a href="#cb37-73" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"0"</span>, <span class="st">".5"</span>, <span class="st">"1"</span>)) <span class="sc">+</span></span>
<span id="cb37-74"><a href="#cb37-74" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="co">#xlim = c(-0.01,1.01), </span></span>
<span id="cb37-75"><a href="#cb37-75" aria-hidden="true" tabindex="-1"></a>                  <span class="at">expand =</span> <span class="dv">0</span>,</span>
<span id="cb37-76"><a href="#cb37-76" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">25</span>))<span class="sc">+</span></span>
<span id="cb37-77"><a href="#cb37-77" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Learn Unpaired"</span>) <span class="sc">+</span></span>
<span id="cb37-78"><a href="#cb37-78" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb37-79"><a href="#cb37-79" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">family =</span> <span class="st">"Arial"</span>,</span>
<span id="cb37-80"><a href="#cb37-80" aria-hidden="true" tabindex="-1"></a>                              <span class="at">size =</span> text_size),</span>
<span id="cb37-81"><a href="#cb37-81" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb37-82"><a href="#cb37-82" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb37-83"><a href="#cb37-83" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb37-84"><a href="#cb37-84" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> .<span class="dv">5</span>,<span class="at">vjust =</span> <span class="dv">0</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Dropping 'draws_df' class as required metadata was removed.
Warning: Dropping 'draws_df' class as required metadata was removed.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Picking joint bandwidth of 0.00298</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Picking joint bandwidth of 0.0156</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Farkas_HBM_supplemental_workflow_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Scaling posteriors are also still wide like Model S1.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>model004_fit_learning_rate_posteriors <span class="sc">%&gt;%</span> </span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">starts_with</span>(<span class="st">"scaling"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">factor</span>(name, <span class="at">levels =</span> (<span class="fu">unique</span>(name)))) <span class="sc">%&gt;%</span> </span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(<span class="at">x =</span> value,</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>                   <span class="at">color =</span> name,</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>                   <span class="at">fill =</span> name),</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>               <span class="at">linewidth =</span> <span class="dv">1</span>,</span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>               <span class="at">alpha =</span> .<span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">5</span>,<span class="dv">5</span>,<span class="at">by =</span> <span class="dv">1</span>), <span class="at">name =</span> <span class="st">"Δ Z-Scored ssVEP"</span>) <span class="sc">+</span></span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> cue_color) <span class="sc">+</span></span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> cue_color) <span class="sc">+</span></span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">5</span>,<span class="dv">5</span>)) <span class="sc">+</span></span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Dropping 'draws_df' class as required metadata was removed.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Farkas_HBM_supplemental_workflow_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>So similar to Model S1, S2 just does not fit the data well and is hard to interpret based on what we know about conditioning.</p>
</section>
<section id="model-s3-arousal-ratings-per-cue-and-block" class="level2">
<h2 class="anchored" data-anchor-id="model-s3-arousal-ratings-per-cue-and-block">Model S3: Arousal ratings per cue and block</h2>
<p>The experiment collects ratings for each cue at the end of each block. This includes valence and arousal from 0 to 10 (integers), and expectancy of shock (0 to 100%; increments of 10). As the cues get paired with shocks, it is expected the ssVEP amplitude will increase with arousal ratings for the CS+. To test this, the ratings per participant were used as a predictor of ssVEP amplitude in conjunction with the adaption effect. The first model uses the arousal rating at the end of each block as an effect added linearly to each trial. This is done to prevent sharp shifts and to provide an intercept when shifting from one block to the next.The complete Stan model (excluding adaptions priors) code is presented here:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>model005_fit<span class="sc">$</span><span class="fu">code</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  [1] "data {"                                                                                                                                                                   
  [2] "  int&lt;lower=0&gt; n;"                                                                                                                                                        
  [3] "  int&lt;lower=0&gt; n_observations;"                                                                                                                                           
  [4] "  int&lt;lower=0&gt; n_missing;"                                                                                                                                                
  [5] "  int&lt;lower=0&gt; n_participants;"                                                                                                                                           
  [6] "  int&lt;lower=0&gt; n_trials; "                                                                                                                                                
  [7] "  int&lt;lower=0&gt; n_phases;"                                                                                                                                                 
  [8] "  int&lt;lower=0&gt; n_blocks;"                                                                                                                                                 
  [9] "  int&lt;lower=0&gt; n_cues;"                                                                                                                                                   
 [10] ""                                                                                                                                                                         
 [11] "  array[n_observations] real amplitude;"                                                                                                                                  
 [12] "  array[n] int participant;"                                                                                                                                              
 [13] "  array[n] int phase;"                                                                                                                                                    
 [14] "  array[n] int cue;"                                                                                                                                                      
 [15] "  array[n] int trial;"                                                                                                                                                    
 [16] "  array[n] int cue_trial_count;"                                                                                                                                          
 [17] "  array[n] int phase_trial_count;"                                                                                                                                        
 [18] "  array[n] int block_trial_count;"                                                                                                                                        
 [19] "  array[n_participants, n_blocks, n_cues] real arousal_pbc_centered;"                                                                                                     
 [20] "  array[n_participants, n_blocks, n_cues] real arousal_pbc;"                                                                                                              
 [21] "  array[n] int block;"                                                                                                                                                    
 [22] "  array[n] int &lt;lower=0, upper=1&gt; paired;"                                                                                                                                
 [23] "  array[n_observations] int&lt;lower=1, upper=n_observations + n_missing&gt; indices_observed;"                                                                                 
 [24] "  array[n_missing] int&lt;lower=1, upper=n_observations + n_missing&gt; indices_missing;"                                                                                       
 [25] "}"                                                                                                                                                                        
 [26] ""                                                                                                                                                                         
 [27] "parameters {"                                                                                                                                                             
 [28] ""                                                                                                                                                                         
 [29] "  real&lt;lower = 0&gt; sigma_average; //this won't hug zero so it does not need to be exp() //1"                                                                               
 [30] "  real sigma_sd_raw; //2"                                                                                                                                                 
 [31] "  real intercept_average; //3"                                                                                                                                            
 [32] "  real intercept_sd_raw; //4"                                                                                                                                             
 [33] "  real fatigue_average; //5"                                                                                                                                              
 [34] "  real fatigue_sd_raw; //6"                                                                                                                                               
 [35] "  real intercept_fatigue_corr_raw; //7"                                                                                                                                   
 [36] "  "                                                                                                                                                                       
 [37] "  real b_arousal_average; //8"                                                                                                                                            
 [38] "  real b_arousal_sd_raw; //9  "                                                                                                                                           
 [39] "  "                                                                                                                                                                       
 [40] "  array[n_participants] real&lt;lower = 0&gt; sigma; //this won't hug zero so it does not need to be exp() //33 if n_participants is 24"                                        
 [41] "  array[n_participants] real intercept; //57"                                                                                                                             
 [42] "  array[n_participants] real fatigue; //81"                                                                                                                               
 [43] "  "                                                                                                                                                                       
 [44] "  array[n_participants] real b_arousal; //105    "                                                                                                                        
 [45] ""                                                                                                                                                                         
 [46] "  array[n_missing] real amplitude_missing;"                                                                                                                               
 [47] "}"                                                                                                                                                                        
 [48] ""                                                                                                                                                                         
 [49] "transformed parameters {"                                                                                                                                                 
 [50] "  array[n] real amplitude_all;"                                                                                                                                           
 [51] "  amplitude_all[indices_observed] = amplitude;"                                                                                                                           
 [52] "  amplitude_all[indices_missing] = amplitude_missing;"                                                                                                                    
 [53] "  "                                                                                                                                                                       
 [54] "  real sigma_sd = exp(sigma_sd_raw);"                                                                                                                                     
 [55] "  real intercept_sd = exp(intercept_sd_raw);"                                                                                                                             
 [56] "  real fatigue_sd = exp(fatigue_sd_raw);"                                                                                                                                 
 [57] "  "                                                                                                                                                                       
 [58] "  real intercept_fatigue_corr = -inv_logit(intercept_fatigue_corr_raw);"                                                                                                  
 [59] ""                                                                                                                                                                         
 [60] "  cov_matrix[2] Sigma;"                                                                                                                                                   
 [61] "  Sigma[1,1] = square(intercept_sd);"                                                                                                                                     
 [62] "  Sigma[2,2] = square(fatigue_sd);"                                                                                                                                       
 [63] "  Sigma[1,2] = intercept_fatigue_corr * intercept_sd * fatigue_sd;"                                                                                                       
 [64] "  Sigma[2,1] = Sigma[1,2];"                                                                                                                                               
 [65] "  "                                                                                                                                                                       
 [66] "  matrix[2,2] Sigma_L = cholesky_decompose(Sigma);"                                                                                                                       
 [67] "  "                                                                                                                                                                       
 [68] "  real b_arousal_sd = exp(b_arousal_sd_raw);       "                                                                                                                      
 [69] "  "                                                                                                                                                                       
 [70] "  array[n] real mu;"                                                                                                                                                      
 [71] "  "                                                                                                                                                                       
 [72] "  // Hard-coded number of trials per block (for the transition)."                                                                                                         
 [73] "  // Adjust this if your block size differs."                                                                                                                             
 [74] "  // 48 trials per block except for block 1."                                                                                                                             
 [75] "  real trials_per_block = 48.0;"                                                                                                                                          
 [76] ""                                                                                                                                                                         
 [77] "  for (i in 1:n) {"                                                                                                                                                       
 [78] "    // Fatigue contribution grows with block_trial_count[i]"                                                                                                              
 [79] "    real fatigue_contrib = fatigue[participant[i]] * trial[i];"                                                                                                           
 [80] ""                                                                                                                                                                         
 [81] "    // Compute arousal effect"                                                                                                                                            
 [82] "    if (block[i] == 1) {"                                                                                                                                                 
 [83] "      // For the first block, use the block's arousal rating directly"                                                                                                    
 [84] "      mu[i] = intercept[participant[i]] "                                                                                                                                 
 [85] "              + fatigue_contrib"                                                                                                                                          
 [86] "              + b_arousal[participant[i]] * arousal_pbc[participant[i], block[i], cue[i]];"                                                                               
 [87] "              // + b_arousal[participant[i]] * arousal_pbc_centered[participant[i], block[i], cue[i]];"                                                                   
 [88] "    } else {"                                                                                                                                                             
 [89] "      // For subsequent blocks, smoothly transition from the previous block's rating"                                                                                     
 [90] "      real previous_arousal = arousal_pbc[participant[i], block[i]-1, cue[i]];"                                                                                           
 [91] "      real current_arousal  = arousal_pbc[participant[i], block[i], cue[i]];"                                                                                             
 [92] "      // real previous_arousal = arousal_pbc_centered[participant[i], block[i]-1, cue[i]];"                                                                               
 [93] "      // real current_arousal  = arousal_pbc_centered[participant[i], block[i], cue[i]];"                                                                                 
 [94] ""                                                                                                                                                                         
 [95] "      // Weight previous block's arousal more at the start of the new block,"                                                                                             
 [96] "      // and gradually shift to the current block's arousal by the block's end."                                                                                          
 [97] "      real weight_previous = (trials_per_block - block_trial_count[i]) / trials_per_block;"                                                                               
 [98] "      real weight_current = block_trial_count[i] / trials_per_block;"                                                                                                     
 [99] ""                                                                                                                                                                         
[100] "      real blended_arousal = previous_arousal * weight_previous + current_arousal * weight_current;"                                                                      
[101] ""                                                                                                                                                                         
[102] "      mu[i] = intercept[participant[i]]"                                                                                                                                  
[103] "              + fatigue_contrib"                                                                                                                                          
[104] "              + b_arousal[participant[i]] * blended_arousal;"                                                                                                             
[105] "    }"                                                                                                                                                                    
[106] "  }"                                                                                                                                                                      
[107] "}"                                                                                                                                                                        
[108] ""                                                                                                                                                                         
[109] "model {"                                                                                                                                                                  
[110] "  // Priors"                                                                                                                                                              
[111] "  sigma_average ~ normal(1, 0.5);"                                                                                                                                        
[112] "  sigma_sd_raw ~ normal(-3, 1);"                                                                                                                                          
[113] ""                                                                                                                                                                         
[114] "  sigma ~ student_t(n_participants-1, sigma_average, sigma_sd);"                                                                                                          
[115] ""                                                                                                                                                                         
[116] "  intercept_average ~ normal(0, 0.75);"                                                                                                                                   
[117] "  intercept_sd_raw ~ normal(-1, 1);"                                                                                                                                      
[118] "  fatigue_average ~ normal(0, 0.01);"                                                                                                                                     
[119] "  fatigue_sd_raw ~ normal(-4.5, 0.75);"                                                                                                                                   
[120] "  "                                                                                                                                                                       
[121] "  intercept_fatigue_corr_raw ~ normal(0, 1.75); // this creates a roughly uniform distribution, if confused visualize in R with hist(boot::inv.logit(rnorm(5000,0,1.75)))"
[122] "  "                                                                                                                                                                       
[123] "  for (p in 1:n_participants) {"                                                                                                                                          
[124] "    [intercept[p], fatigue[p]]' ~ multi_student_t_cholesky(n_participants - 1,"                                                                                           
[125] "                                                           [intercept_average, fatigue_average]',"                                                                        
[126] "                                                           Sigma_L);"                                                                                                     
[127] "  }"                                                                                                                                                                      
[128] "  "                                                                                                                                                                       
[129] ""                                                                                                                                                                         
[130] ""                                                                                                                                                                         
[131] "  b_arousal_average ~ normal(0, 0.01);"                                                                                                                                   
[132] "  b_arousal_sd_raw ~ normal(-4.5, 0.75);"                                                                                                                                 
[133] "  // b_arousal_sd_raw ~ normal(-0.5,1.5);"                                                                                                                                
[134] "  b_arousal ~ student_t(n_participants-1, b_arousal_average, b_arousal_sd);"                                                                                              
[135] ""                                                                                                                                                                         
[136] "  // Likelihood"                                                                                                                                                          
[137] "  for(i in 1:n)"                                                                                                                                                          
[138] "    amplitude_all[i] ~ normal(mu[i], sigma[participant[i]]);"                                                                                                             
[139] "}"                                                                                                                                                                        
[140] ""                                                                                                                                                                         
[141] "generated quantities {"                                                                                                                                                   
[142] "  array[n_observations] real mu_pred = mu[indices_observed];"                                                                                                             
[143] "  array[n_observations] real log_lik;"                                                                                                                                    
[144] "  "                                                                                                                                                                       
[145] "  for (i in 1:n_observations) {"                                                                                                                                          
[146] "    log_lik[i] = normal_lpdf(amplitude[i] | mu_pred[i], sigma[participant[i]]);"                                                                                          
[147] "  }"                                                                                                                                                                      
[148] "}"                                                                                                                                                                        </code></pre>
</div>
</div>
<p>This model fits fine and leads to a small effect in the expected direction. The 97% of the posterior for the average effect of arousal across trials is above zero. The median being .012 means for each change in unit change in the arousal ratings, we could expect a .012 change in z-scored ssVEP per trial.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>model005_b_arousal_average <span class="ot">&lt;-</span> model005_fit<span class="sc">$</span><span class="fu">draws</span>(<span class="at">variables =</span> <span class="st">"b_arousal_average"</span>, <span class="at">format =</span> <span class="st">"df"</span>)</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>model005_b_arousal_average <span class="sc">%&gt;%</span> </span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="fu">aes</span>(<span class="at">xintercept =</span> <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(<span class="at">x =</span> b_arousal_average)) <span class="sc">+</span> </span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Farkas_HBM_supplemental_workflow_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(model005_b_arousal_average<span class="sc">$</span>b_arousal_average <span class="sc">&gt;</span> <span class="dv">0</span> ) <span class="sc">/</span> <span class="fu">nrow</span>(model005_b_arousal_average)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.9696375</code></pre>
</div>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">quantile</span>(model005_b_arousal_average<span class="sc">$</span>b_arousal_average, <span class="at">probs =</span> <span class="fu">c</span>(.<span class="dv">025</span>, .<span class="dv">5</span>, .<span class="dv">975</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         2.5%           50%         97.5% 
-0.0004992959  0.0116113000  0.0237132300 </code></pre>
</div>
</div>
<p>There is not much evidence that the slope differs between participants.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>model005_b_arousal <span class="ot">&lt;-</span> model005_fit<span class="sc">$</span><span class="fu">draws</span>(<span class="at">variables =</span> <span class="st">"b_arousal"</span>, <span class="at">format =</span> <span class="st">"df"</span>)</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>model005_b_arousal <span class="sc">%&gt;%</span> </span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">starts_with</span>(<span class="st">"b_arousal"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">factor</span>(name, <span class="at">levels =</span> <span class="fu">rev</span>(<span class="fu">unique</span>(name)))) <span class="sc">%&gt;%</span> </span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="fu">aes</span>(<span class="at">xintercept =</span> <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density_ridges</span>(<span class="fu">aes</span>(<span class="at">y =</span> name, <span class="at">x =</span> value)) <span class="sc">+</span> </span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Dropping 'draws_df' class as required metadata was removed.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Picking joint bandwidth of 0.000783</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Farkas_HBM_supplemental_workflow_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="model-s4-arousal-ratings-centered-per-cue-and-block" class="level2">
<h2 class="anchored" data-anchor-id="model-s4-arousal-ratings-centered-per-cue-and-block">Model S4: Arousal ratings (centered) per cue and block</h2>
<p>It was speculated that participant may be using the scale differently so centering the rating per participant by subtracting the mean rating within participant may affect the results. The average effect was similar but with less of the posterior extending above zero (0.90%).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>model006_b_arousal_average <span class="ot">&lt;-</span> model006_fit<span class="sc">$</span><span class="fu">draws</span>(<span class="at">variables =</span> <span class="st">"b_arousal_average"</span>, <span class="at">format =</span> <span class="st">"df"</span>)</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>model006_b_arousal_average <span class="sc">%&gt;%</span> </span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="fu">aes</span>(<span class="at">xintercept =</span> <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(<span class="at">x =</span> b_arousal_average)) <span class="sc">+</span> </span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Farkas_HBM_supplemental_workflow_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(model006_b_arousal_average<span class="sc">$</span>b_arousal_average <span class="sc">&gt;</span> <span class="dv">0</span> ) <span class="sc">/</span> <span class="fu">nrow</span>(model006_b_arousal_average)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.8986125</code></pre>
</div>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">quantile</span>(model006_b_arousal_average<span class="sc">$</span>b_arousal_average, <span class="at">probs =</span> <span class="fu">c</span>(.<span class="dv">025</span>, .<span class="dv">5</span>, .<span class="dv">975</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        2.5%          50%        97.5% 
-0.005518036  0.009848275  0.024428300 </code></pre>
</div>
</div>
<p>Yet, unlike the last model, this led to more variation between participant slopes.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>model006_b_arousal <span class="ot">&lt;-</span> model006_fit<span class="sc">$</span><span class="fu">draws</span>(<span class="at">variables =</span> <span class="st">"b_arousal"</span>, <span class="at">format =</span> <span class="st">"df"</span>)</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>model006_b_arousal <span class="sc">%&gt;%</span> </span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">starts_with</span>(<span class="st">"b_arousal"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">factor</span>(name, <span class="at">levels =</span> <span class="fu">rev</span>(<span class="fu">unique</span>(name)))) <span class="sc">%&gt;%</span> </span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="fu">aes</span>(<span class="at">xintercept =</span> <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density_ridges</span>(<span class="fu">aes</span>(<span class="at">y =</span> name, <span class="at">x =</span> value)) <span class="sc">+</span> </span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Dropping 'draws_df' class as required metadata was removed.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Picking joint bandwidth of 0.00267</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Farkas_HBM_supplemental_workflow_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="model-s5-arousal-expectancy-ratings-per-cue-and-block" class="level2">
<h2 class="anchored" data-anchor-id="model-s5-arousal-expectancy-ratings-per-cue-and-block">Model S5: Arousal &amp; expectancy ratings per cue and block</h2>
<p>The final model attempted to use arousal and shock-expectancy ratings to predict cue effects. This was done through main effects and an interaction:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>model007_fit<span class="sc">$</span><span class="fu">code</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  [1] "data {"                                                                                                                                                                   
  [2] "  int&lt;lower=0&gt; n;"                                                                                                                                                        
  [3] "  int&lt;lower=0&gt; n_observations;"                                                                                                                                           
  [4] "  int&lt;lower=0&gt; n_missing;"                                                                                                                                                
  [5] "  int&lt;lower=0&gt; n_participants;"                                                                                                                                           
  [6] "  int&lt;lower=0&gt; n_trials; "                                                                                                                                                
  [7] "  int&lt;lower=0&gt; n_phases;"                                                                                                                                                 
  [8] "  int&lt;lower=0&gt; n_blocks;"                                                                                                                                                 
  [9] "  int&lt;lower=0&gt; n_cues;"                                                                                                                                                   
 [10] ""                                                                                                                                                                         
 [11] "  array[n_observations] real amplitude;"                                                                                                                                  
 [12] "  array[n] int participant;"                                                                                                                                              
 [13] "  array[n] int phase;"                                                                                                                                                    
 [14] "  array[n] int cue;"                                                                                                                                                      
 [15] "  array[n] int trial;"                                                                                                                                                    
 [16] "  array[n] int cue_trial_count;"                                                                                                                                          
 [17] "  array[n] int phase_trial_count;"                                                                                                                                        
 [18] "  array[n] int block_trial_count;"                                                                                                                                        
 [19] "  array[n_participants, n_blocks, n_cues] real arousal_pbc_centered;"                                                                                                     
 [20] "  array[n_participants, n_blocks, n_cues] real arousal_pbc;"                                                                                                              
 [21] "  array[n_participants, n_blocks, n_cues] real expect_pbc_centered;"                                                                                                      
 [22] "  array[n_participants, n_blocks, n_cues] real expect_pbc;"                                                                                                               
 [23] "  array[n] int block;"                                                                                                                                                    
 [24] "  array[n] int &lt;lower=0, upper=1&gt; paired;"                                                                                                                                
 [25] "  array[n_observations] int&lt;lower=1, upper=n_observations + n_missing&gt; indices_observed;"                                                                                 
 [26] "  array[n_missing] int&lt;lower=1, upper=n_observations + n_missing&gt; indices_missing;"                                                                                       
 [27] "}"                                                                                                                                                                        
 [28] ""                                                                                                                                                                         
 [29] "parameters {"                                                                                                                                                             
 [30] ""                                                                                                                                                                         
 [31] "  real&lt;lower = 0&gt; sigma_average; //this won't hug zero so it does not need to be exp() //1"                                                                               
 [32] "  real sigma_sd_raw; //2"                                                                                                                                                 
 [33] "  real intercept_average; //3"                                                                                                                                            
 [34] "  real intercept_sd_raw; //4"                                                                                                                                             
 [35] "  real fatigue_average; //5"                                                                                                                                              
 [36] "  real fatigue_sd_raw; //6"                                                                                                                                               
 [37] "  real intercept_fatigue_corr_raw; //7"                                                                                                                                   
 [38] "  "                                                                                                                                                                       
 [39] "  real b_arousal_average; //8"                                                                                                                                            
 [40] "  real b_arousal_sd_raw; //9  "                                                                                                                                           
 [41] ""                                                                                                                                                                         
 [42] "  real b_expect_average; //10   "                                                                                                                                         
 [43] "  real b_expect_sd_raw; //11"                                                                                                                                             
 [44] "  "                                                                                                                                                                       
 [45] "  real b_arousal_expect_average; //12"                                                                                                                                    
 [46] "  real b_arousal_expect_sd_raw; //13 "                                                                                                                                    
 [47] "  "                                                                                                                                                                       
 [48] "  array[n_participants] real&lt;lower = 0&gt; sigma; //this won't hug zero so it does not need to be exp() //37 if n_participants is 24"                                        
 [49] "  array[n_participants] real intercept; //61"                                                                                                                             
 [50] "  array[n_participants] real fatigue; //85"                                                                                                                               
 [51] "  "                                                                                                                                                                       
 [52] "  array[n_participants] real b_arousal; //109       "                                                                                                                     
 [53] "  array[n_participants] real b_expect; //133"                                                                                                                             
 [54] "  array[n_participants] real b_arousal_expect; //157       "                                                                                                              
 [55] ""                                                                                                                                                                         
 [56] "  array[n_missing] real amplitude_missing;"                                                                                                                               
 [57] "}"                                                                                                                                                                        
 [58] ""                                                                                                                                                                         
 [59] "transformed parameters {"                                                                                                                                                 
 [60] "  array[n] real amplitude_all;"                                                                                                                                           
 [61] "  amplitude_all[indices_observed] = amplitude;"                                                                                                                           
 [62] "  amplitude_all[indices_missing] = amplitude_missing;"                                                                                                                    
 [63] "  "                                                                                                                                                                       
 [64] "  real sigma_sd = exp(sigma_sd_raw);"                                                                                                                                     
 [65] "  real intercept_sd = exp(intercept_sd_raw);"                                                                                                                             
 [66] "  real fatigue_sd = exp(fatigue_sd_raw);"                                                                                                                                 
 [67] "  "                                                                                                                                                                       
 [68] "  real intercept_fatigue_corr = -inv_logit(intercept_fatigue_corr_raw);"                                                                                                  
 [69] ""                                                                                                                                                                         
 [70] "  cov_matrix[2] Sigma;"                                                                                                                                                   
 [71] "  Sigma[1,1] = square(intercept_sd);"                                                                                                                                     
 [72] "  Sigma[2,2] = square(fatigue_sd);"                                                                                                                                       
 [73] "  Sigma[1,2] = intercept_fatigue_corr * intercept_sd * fatigue_sd;"                                                                                                       
 [74] "  Sigma[2,1] = Sigma[1,2];"                                                                                                                                               
 [75] "  "                                                                                                                                                                       
 [76] "  matrix[2,2] Sigma_L = cholesky_decompose(Sigma);"                                                                                                                       
 [77] "  "                                                                                                                                                                       
 [78] "  real b_arousal_sd = exp(b_arousal_sd_raw);   "                                                                                                                          
 [79] "  "                                                                                                                                                                       
 [80] "  real b_expect_sd = exp(b_expect_sd_raw);       "                                                                                                                        
 [81] "  "                                                                                                                                                                       
 [82] "  real b_arousal_expect_sd = exp(b_arousal_expect_sd_raw);       "                                                                                                        
 [83] "  "                                                                                                                                                                       
 [84] "  array[n] real mu;"                                                                                                                                                      
 [85] "  "                                                                                                                                                                       
 [86] "  // Hard-coded number of trials per block (for the transition)."                                                                                                         
 [87] "  // Adjust this if your block size differs."                                                                                                                             
 [88] "  // 48 trials per block except for block 1."                                                                                                                             
 [89] "  real trials_per_block = 48.0;"                                                                                                                                          
 [90] ""                                                                                                                                                                         
 [91] "  for (i in 1:n) {"                                                                                                                                                       
 [92] "    // Fatigue contribution grows with block_trial_count[i]"                                                                                                              
 [93] "    real fatigue_contrib = fatigue[participant[i]] * trial[i];"                                                                                                           
 [94] ""                                                                                                                                                                         
 [95] "    // Compute arousal effect"                                                                                                                                            
 [96] "    if (block[i] == 1) {"                                                                                                                                                 
 [97] "      // For the first block, use the block's ratings directly"                                                                                                           
 [98] "      mu[i] = intercept[participant[i]] "                                                                                                                                 
 [99] "              + fatigue_contrib"                                                                                                                                          
[100] "              + b_arousal[participant[i]] * arousal_pbc[participant[i], block[i], cue[i]] +"                                                                              
[101] "              + b_expect[participant[i]] * expect_pbc[participant[i], block[i], cue[i]] +"                                                                                
[102] "              + b_arousal_expect[participant[i]] * arousal_pbc[participant[i], block[i], cue[i]] * expect_pbc[participant[i], block[i], cue[i]];"                         
[103] "              "                                                                                                                                                           
[104] "    } else {"                                                                                                                                                             
[105] "      // For subsequent blocks, smoothly transition from the previous block's ratings"                                                                                    
[106] "      real previous_arousal = arousal_pbc[participant[i], block[i]-1, cue[i]];"                                                                                           
[107] "      real current_arousal  = arousal_pbc[participant[i], block[i], cue[i]];"                                                                                             
[108] "      real previous_expect = expect_pbc[participant[i], block[i]-1, cue[i]];"                                                                                             
[109] "      real current_expect  = expect_pbc[participant[i], block[i], cue[i]];"                                                                                               
[110] ""                                                                                                                                                                         
[111] "      // Weight previous block's arousal more at the start of the new block,"                                                                                             
[112] "      // and gradually shift to the current block's arousal by the block's end."                                                                                          
[113] "      real weight_previous = (trials_per_block - block_trial_count[i]) / trials_per_block;"                                                                               
[114] "      real weight_current = block_trial_count[i] / trials_per_block;"                                                                                                     
[115] ""                                                                                                                                                                         
[116] "      real blended_arousal = previous_arousal * weight_previous + current_arousal * weight_current;"                                                                      
[117] "      real blended_expect = previous_expect * weight_previous + current_expect * weight_current;"                                                                         
[118] ""                                                                                                                                                                         
[119] "      mu[i] = intercept[participant[i]]"                                                                                                                                  
[120] "              + fatigue_contrib"                                                                                                                                          
[121] "              + b_arousal[participant[i]] * blended_arousal +"                                                                                                            
[122] "              + b_expect[participant[i]] * blended_expect +"                                                                                                              
[123] "              + b_arousal_expect[participant[i]] * blended_arousal * blended_expect;"                                                                                     
[124] "    }"                                                                                                                                                                    
[125] "  }"                                                                                                                                                                      
[126] "}"                                                                                                                                                                        
[127] ""                                                                                                                                                                         
[128] "model {"                                                                                                                                                                  
[129] "  // Priors"                                                                                                                                                              
[130] "  sigma_average ~ normal(1, 0.5);"                                                                                                                                        
[131] "  sigma_sd_raw ~ normal(-3, 1);"                                                                                                                                          
[132] ""                                                                                                                                                                         
[133] "  sigma ~ student_t(n_participants-1, sigma_average, sigma_sd);"                                                                                                          
[134] ""                                                                                                                                                                         
[135] "  intercept_average ~ normal(0, 0.75);"                                                                                                                                   
[136] "  intercept_sd_raw ~ normal(-1, 1);"                                                                                                                                      
[137] "  fatigue_average ~ normal(0, 0.01);"                                                                                                                                     
[138] "  fatigue_sd_raw ~ normal(-4.5, 0.75);"                                                                                                                                   
[139] "  "                                                                                                                                                                       
[140] "  intercept_fatigue_corr_raw ~ normal(0, 1.75); // this creates a roughly uniform distribution, if confused visualize in R with hist(boot::inv.logit(rnorm(5000,0,1.75)))"
[141] "  "                                                                                                                                                                       
[142] "  for (p in 1:n_participants) {"                                                                                                                                          
[143] "    [intercept[p], fatigue[p]]' ~ multi_student_t_cholesky(n_participants - 1,"                                                                                           
[144] "                                                           [intercept_average, fatigue_average]',"                                                                        
[145] "                                                           Sigma_L);"                                                                                                     
[146] "  }"                                                                                                                                                                      
[147] "  "                                                                                                                                                                       
[148] ""                                                                                                                                                                         
[149] ""                                                                                                                                                                         
[150] "  b_arousal_average ~ normal(0, 0.01);"                                                                                                                                   
[151] "  b_arousal_sd_raw ~ normal(-4.5, 0.75);"                                                                                                                                 
[152] "  b_arousal ~ student_t(n_participants-1, b_arousal_average, b_arousal_sd);"                                                                                              
[153] ""                                                                                                                                                                         
[154] "  b_expect_average ~ normal(0, 0.01);"                                                                                                                                    
[155] "  b_expect_sd_raw ~ normal(-4.5, 0.75);"                                                                                                                                  
[156] "  b_expect ~ student_t(n_participants-1, b_expect_average, b_expect_sd);"                                                                                                 
[157] "  "                                                                                                                                                                       
[158] "  b_arousal_expect_average ~ normal(0, 0.01);"                                                                                                                            
[159] "  b_arousal_expect_sd_raw ~ normal(-4.5, 0.75);"                                                                                                                          
[160] "  b_arousal_expect ~ student_t(n_participants-1, b_arousal_expect_average, b_arousal_expect_sd);"                                                                         
[161] ""                                                                                                                                                                         
[162] "  // Likelihood"                                                                                                                                                          
[163] "  for(i in 1:n)"                                                                                                                                                          
[164] "    amplitude_all[i] ~ normal(mu[i], sigma[participant[i]]);"                                                                                                             
[165] "}"                                                                                                                                                                        
[166] ""                                                                                                                                                                         
[167] "generated quantities {"                                                                                                                                                   
[168] "  array[n_observations] real mu_pred = mu[indices_observed];"                                                                                                             
[169] "  array[n_observations] real log_lik;"                                                                                                                                    
[170] "  "                                                                                                                                                                       
[171] "  for (i in 1:n_observations) {"                                                                                                                                          
[172] "    log_lik[i] = normal_lpdf(amplitude[i] | mu_pred[i], sigma[participant[i]]);"                                                                                          
[173] "  }"                                                                                                                                                                      
[174] "}"                                                                                                                                                                        </code></pre>
</div>
</div>
<p>At this point, the slope made very little sense and appeared to just be overfitting to subject specific patterns. Taking these three models together, it did not seem justified to publish these results making any definitive points on a preliminary data set of a limited sample size. While it is noteworthy that there is a small arousal effect, it is likely limited by the fact that many of the participants do not show an ssVEP effect at all. So we instead focused on publishing a method paper on the Bayesian method and plan to return to the ratings when more data is available and we are more confident in the reasons why the ssVEP effect was not present for many of the participants. Future efforts that look at fMRI we expect will also aid in ratings interpretations.</p>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>